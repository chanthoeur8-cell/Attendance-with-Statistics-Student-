<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIKIDS á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áŸá·áŸáŸ’áŸ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Khmer OS Battambang', 'Khmer OS Siemreap', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .main-header {
            background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .main-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .main-header p {
            font-size: 16px;
            opacity: 0.9;
        }

        /* Main Navigation Tabs */
        .main-tabs {
            display: flex;
            background: #f8f9fc;
            border-bottom: 3px solid #e3e6f0;
        }

        .main-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            color: #5a5c69;
            background: #f8f9fc;
            border: none;
            transition: all 0.3s;
            position: relative;
        }

        .main-tab:hover {
            background: #eaecf4;
            color: #4e73df;
        }

        .main-tab.active {
            background: white;
            color: #4e73df;
        }

        .main-tab.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #4e73df;
        }

        .main-tab-content {
            display: none;
        }

        .main-tab-content.active {
            display: block;
        }

        /* ========== ATTENDANCE SYSTEM STYLES ========== */
        .attendance-container {
            display: flex;
            height: calc(100vh - 250px);
            min-height: 600px;
        }

        .sidebar {
            width: 320px;
            background: #f8f9fc;
            padding: 20px;
            border-right: 1px solid #e3e6f0;
            overflow-y: auto;
        }

        .section-title {
            font-weight: bold;
            color: #4e73df;
            margin: 15px 0 10px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e3e6f0;
            font-size: 16px;
        }

        .date-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #d1d3e2;
            margin-bottom: 15px;
            font-family: inherit;
            font-size: 15px;
        }

        .class-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .class-item {
            padding: 12px;
            background: white;
            border: 2px solid #d1d3e2;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.2s;
        }

        .class-item:hover {
            background: #eaecf4;
            border-color: #4e73df;
        }

        .class-item.active {
            background: #4e73df;
            color: white;
            border-color: #4e73df;
        }

        .content-area {
            flex: 1;
            padding: 25px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .class-title {
            margin-bottom: 20px;
            color: #4e73df;
            font-size: 22px;
            font-weight: bold;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-box {
            text-align: center;
            padding: 15px;
            background: #f8f9fc;
            border-radius: 10px;
            border: 2px solid #e3e6f0;
        }

        .summary-box .label {
            font-size: 14px;
            color: #5a5c69;
            margin-bottom: 8px;
        }

        .summary-box .count {
            font-size: 28px;
            font-weight: bold;
        }

        .list-header {
            background: #f8f9fc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e3e6f0;
            font-weight: bold;
            color: #5a5c69;
            font-size: 16px;
        }

        #studentContainer {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .student-card {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #fff;
            border: 2px solid #e3e6f0;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }

        .student-card:hover {
            border-color: #4e73df;
            box-shadow: 0 4px 10px rgba(78, 115, 223, 0.1);
        }

        .student-id {
            font-weight: bold;
            color: #4e73df;
            width: 50px;
            font-size: 16px;
        }

        .student-info {
            flex: 1;
            margin-left: 15px;
        }

        .student-name {
            font-weight: bold;
            font-size: 16px;
            color: #2e59d9;
            margin-bottom: 4px;
        }

        .student-sex {
            font-size: 13px;
            color: #858796;
        }

        .attendance-btns {
            display: flex;
            gap: 10px;
        }

        .btn-att {
            width: 50px;
            height: 50px;
            border: 2px solid #d1d3e2;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            background: #f8f9fc;
            font-size: 18px;
            transition: all 0.2s;
        }

        .btn-att:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-att.present.active {
            background: #1cc88a !important;
            color: white;
            border-color: #1cc88a;
        }

        .btn-att.permission.active {
            background: #f6c23e !important;
            color: white;
            border-color: #f6c23e;
        }

        .btn-att.absent.active {
            background: #e74a3b !important;
            color: white;
            border-color: #e74a3b;
        }

        .bottom-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-main {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
            font-family: inherit;
        }

        .btn-main:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-telegram {
            background: #0088cc;
        }

        .btn-excel {
            background: #28a745;
        }

        /* ========== STATISTICS REPORT STYLES ========== */
        .stats-container {
            padding: 30px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-family: inherit;
            cursor: pointer;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 15px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 15px;
            transition: border-color 0.3s;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .report-list {
            margin-top: 30px;
        }

        .report-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .report-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .report-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .report-date {
            color: #666;
            font-size: 14px;
        }

        .report-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .stat-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .action-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .summary-grid-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .summary-card h4 {
            font-size: 16px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .summary-card .number {
            font-size: 36px;
            font-weight: bold;
        }

        .student-entry {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .student-entry-info {
            flex: 1;
        }

        .student-entry-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .student-entry-details {
            font-size: 13px;
            color: #666;
        }

        .btn-remove {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }

        .btn-remove:hover {
            background: #c82333;
        }

        @media (max-width: 768px) {
            .attendance-container {
                flex-direction: column;
                height: auto;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e3e6f0;
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .report-stats {
                grid-template-columns: 1fr;
            }

            .main-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<div class="main-container">
    <div class="main-header">
        <h1>ğŸ« MIKIDS á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áŸá·áŸáŸ’áŸ</h1>
        <p>á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áœááŸ’áá˜á¶á“ á“á·á„ášá”á¶á™á€á¶ášááŸáŸáŸ’áá·áá·áŸá·áŸáŸ’áŸ</p>
    </div>

    <div class="main-tabs">
        <button class="main-tab active" onclick="switchMainTab('attendance')">ğŸ“‹ áœááŸ’áá˜á¶á“áŸá·áŸáŸ’áŸ</button>
        <button class="main-tab" onclick="switchMainTab('statistics')">ğŸ“Š ášá”á¶á™á€á¶ášááŸáŸáŸ’áá·áá·</button>
    </div>

    <!-- ========== ATTENDANCE SYSTEM ========== -->
    <div id="attendance-system" class="main-tab-content active">
        <div class="attendance-container">
            <div class="sidebar">
                <p class="section-title">á‡áŸ’ášá¾áŸášá¾áŸá€á¶á›á”ášá·á…áŸ’á†áŸá‘</p>
                <input type="date" id="attDate" class="date-input">
                
                <p class="section-title">á”á‰áŸ’á‡á¸ááŸ’á“á¶á€áŸ‹</p>
                <div id="classList" class="class-list"></div>
            </div>

            <div class="content-area">
                <h3 id="displayClass" class="class-title">á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹</h3>
                
                <div class="summary-grid">
                    <div class="summary-box">
                        <div class="label">á˜á€ (âœ”ï¸)</div>
                        <div class="count" id="cP" style="color: #1cc88a;">0</div>
                    </div>
                    <div class="summary-box">
                        <div class="label">á…áŸ’á”á¶á”áŸ‹ (P)</div>
                        <div class="count" id="cL" style="color: #f6c23e;">0</div>
                    </div>
                    <div class="summary-box">
                        <div class="label">á¢áœááŸ’áá˜á¶á“ (A)</div>
                        <div class="count" id="cA" style="color: #e74a3b;">0</div>
                    </div>
                    <div class="summary-box">
                        <div class="label">áŸášá»á”</div>
                        <div class="count" id="cT">0</div>
                    </div>
                </div>

                <div class="list-header">á”á‰áŸ’á‡á¸áŸá·áŸáŸ’áŸ</div>
                <div id="studentContainer"></div>

                <div class="bottom-actions">
                    <button class="btn-main btn-telegram" onclick="sendAttendanceToTelegram()">ğŸ“¤ á•áŸ’á‰á¾á‘áŸ… Telegram</button>
                    <button class="btn-main btn-excel" onclick="exportToExcel()">ğŸ“¥ ášá€áŸ’áŸá¶á‘á»á€á‡á¶ Excel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== STATISTICS SYSTEM ========== -->
    <div id="statistics-system" class="main-tab-content">
        <div class="stats-container">
            <div class="tabs">
                <button class="tab active" onclick="switchStatsTab('create')">á”á„áŸ’á€á¾áášá”á¶á™á€á¶ášááŸááŸ’á˜á¸</button>
                <button class="tab" onclick="switchStatsTab('view')">á˜á¾á›ášá”á¶á™á€á¶ášááŸ</button>
                <button class="tab" onclick="switchStatsTab('summary')">áŸá„áŸ’ááŸá”</button>
            </div>

            <!-- Create Report Tab -->
            <div id="create-tab" class="tab-content active">
                <form id="reportForm">
                    <div class="form-section">
                        <h3>á–áŸááŸŒá˜á¶á“ášá”á¶á™á€á¶ášááŸ</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ááŸ’á„áŸƒááŸ‚á†áŸ’á“á¶áŸ† *</label>
                                <input type="date" id="reportDate" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>áŸáŸ’áá·áá·áŸá·áŸáŸ’áŸáŸášá»á”</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸášá»á” (á“á¶á€áŸ‹) *</label>
                                <input type="number" id="totalStudents" min="0" required>
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸáŸ’ášá¸ (á“á¶á€áŸ‹) *</label>
                                <input type="number" id="femaleStudents" min="0" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>áŸáŸ’áá·áá·áŸá·áŸáŸ’áŸáá¶á˜áœáŸá“ á“á·á„á—á¶áŸá¶</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸášáŸ€á“áœáŸá“á–áŸ’ášá¹á€á•áŸ’á“áŸ‚á€á—á¶áŸá¶ááŸ’á˜áŸ‚áš (á“á¶á€áŸ‹)</label>
                                <input type="number" id="khmerMorning" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸášáŸ€á“áœáŸá“ášáŸáŸ€á›á•áŸ’á“áŸ‚á€á—á¶áŸá¶ááŸ’á˜áŸ‚áš (á“á¶á€áŸ‹)</label>
                                <input type="number" id="khmerAfternoon" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸášáŸ€á“áœáŸá“á–áŸ’ášá¹á€á•áŸ’á“áŸ‚á€á—á¶áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="englishMorning" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸášáŸ€á“áœáŸá“ášáŸáŸ€á›á•áŸ’á“áŸ‚á€á—á¶áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="englishAfternoon" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸášáŸ€á“á‘á¶áŸ†á„á–áŸ’ášá¹á€á‘á¶áŸ†á„ášáŸáŸ€á›á•áŸ’á“áŸ‚á€á—á¶áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="englishBoth" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸášáŸ€á“á‘á¶áŸ†á„á–áŸ’ášá¹á€á‘á¶áŸ†á„ášáŸáŸ€á›á•áŸ’á“áŸ‚á€á—á¶áŸá¶ááŸ’á˜áŸ‚áš (á“á¶á€áŸ‹)</label>
                                <input type="number" id="khmerBoth" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>áŸáŸáœá¶á€á˜áŸ’á˜ á“á·á„áŸá€á˜áŸ’á˜á—á¶á–</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸá‘á‘á½á›áŸáŸáœá¶á˜á¾á›ááŸ‚ááŸ’á„áŸƒááŸ’ášá„áŸ‹ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="lunchCare" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸá¶á€á›áŸ’á”á„ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="trialStudents" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>ááŸ’á“á¶á€áŸ‹áŸá¶á€á›áŸ’á”á„</label>
                                <input type="text" id="trialClass" placeholder="á§. ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡, ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸</h3>
                        <div id="newStudentsList"></div>
                        <div class="form-grid" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹</label>
                                <select id="newStudentClass">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ</label>
                                <input type="text" id="newStudentName" placeholder="á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡">
                            </div>
                            <div class="form-group">
                                <label>á—áŸá‘</label>
                                <select id="newStudentGender">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸ --</option>
                                    <option value="M">á”áŸ’ášá»áŸ</option>
                                    <option value="F">áŸáŸ’ášá¸</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>á€á¶á›á”ášá·á…áŸ’á†áŸá‘á…á¼á›</label>
                                <input type="date" id="newStudentDate">
                            </div>
                        </div>
                        <button type="button" class="btn-main btn-primary" onclick="addNewStudent()" style="margin-top: 10px;">+ á”á“áŸ’ááŸ‚á˜áŸá·áŸáŸ’áŸááŸ’á˜á¸</button>
                    </div>

                    <div class="form-section">
                        <h3>áŸá·áŸáŸ’áŸáˆá”áŸ‹</h3>
                        <div id="leftStudentsList"></div>
                        <div class="form-grid" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ</label>
                                <select id="leftStudentSelect">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>á€á¶á›á”ášá·á…áŸ’á†áŸá‘áˆá”áŸ‹</label>
                                <input type="date" id="leftStudentDate">
                            </div>
                        </div>
                        <button type="button" class="btn-main btn-danger" onclick="addLeftStudent()" style="margin-top: 10px;">+ á”á“áŸ’ááŸ‚á˜áŸá·áŸáŸ’áŸáˆá”áŸ‹</button>
                    </div>

                    <div>
                        <button type="submit" class="btn-main btn-primary">ášá€áŸ’áŸá¶á‘á»á€ášá”á¶á™á€á¶ášááŸ</button>
                        <button type="button" class="btn-main btn-secondary" onclick="resetReportForm()">á€áŸ†áááŸ‹á¡á¾á„áœá·á‰</button>
                    </div>
                </form>
            </div>

            <!-- View Reports Tab -->
            <div id="view-tab" class="tab-content">
                <div id="reportsList"></div>
            </div>

            <!-- Summary Tab -->
            <div id="summary-tab" class="tab-content">
                <div id="summaryContent"></div>
            </div>
        </div>
    </div>
</div>

<script>
// ========== ATTENDANCE SYSTEM DATA ==========
const studentData = {
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(á–áŸ’ášá¹á€)': [
        { id: '64', name: 'áƒá»á“ á‘áŸá–á„áŸ’áŸ', sex: 'M' }, { id: '121', name: 'á“á¿á“ áœáŒáŸ’áá“á¶', sex: 'M' },
        { id: '128', name: 'á–á·áŸá·á‘áŸ’á¢ á…áŸá“áŸ’á‘áœáŒáŸ’áƒ', sex: 'M' }, { id: '141', name: 'á áŸá„ áŸá¶á‡á¸á„', sex: 'F' },
        { id: '132', name: 'áŸá» á”á‰áŸ’á‰á¶ á˜á»á“á·ášá¶á‡', sex: 'M' }, { id: '67', name: 'áˆá¿á“ á”áŸŠá»á“á’á¿á“á–á»á‘áŸ’á’á·', sex: 'M' },
        { id: '173', name: 'áŸá¶á“áŸ’á á›á¸á”áŸ‰áŸá„', sex: 'M' }, { id: '163', name: 'á¢áŸá„ á›á¸á†áŸá„', sex: 'M' },
        { id: '179', name: 'á…á“áŸ’áá¶ áœáŒáŸ’áá“á¶', sex: 'M' }, { id: '162', name: 'á™áŸ‰á¶á“áŸ‹ áŸá»áá¡áŸá„', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(ášáŸáŸ€á›)': [
        { id: '139', name: 'á áŸŠáºá˜ á˜áŸ‰á¸á¢áŸŠá·', sex: 'M' }, { id: '146', name: 'á›á“ áœáŸáŸáŸ’áŸá—á¼', sex: 'M' },
        { id: '102', name: 'áŸáŸ†áá¶á„ áœá¸ášáŸˆá”á»ááŸ’áš', sex: 'M' }, { id: '67', name: 'áˆá¿á“ á”áŸŠá»á“á’á¿á“á–á»á‘áŸ’á’á·', sex: 'M' },
        { id: '87', name: 'á¢áŸŠá»áŸ† ášáá“á¶áŸá·á‘áŸ’á’á¸á€á¶áš', sex: 'F' },{ id: '113', name: 'áŸáŸŠá¸á˜ áŸá·á‘áŸ’á’á¸á€á¶áš', sex: 'F' },
        { id: '164', name: 'á¢áŸŠá¼áŸá»áœááŸ’á áœáŸá á¶áŸ', sex: 'M' }, { id: '177', name: 'áá¶áŸ†á„ á áŸŠá½á™á›á¸á“', sex: 'F' }, 
        { id: '165', name: 'á›á¹á˜ á›á¸á˜áŸ‰áŸá„á‚áŸá„áŸ’á‚', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(á–áŸ’ášá¹á€)': [
        { id: '29', name: 'áá¶á“áŸ‹ á˜á»á“á¸áœá›áŸ’á›á—á¶', sex: 'F' }, { id: '101', name: 'áˆá»áŸ† áœá¸ášáŸ‹áŸá·á‘áŸ’á’', sex: 'M' },
        { id: '65', name: 'á“á·á áŸá»á’á¶ášáŸ‰á¶', sex: 'M' }, { id: '78', name: 'á“á¸ á›á¸á‡á¸á„', sex: 'F' },
        { id: '117', name: 'á áŸŠá»á“ ášá¶ááŸ’áá‡áŸááŸáŸ’áŠá¶', sex: 'M' }, { id: '47', name: 'á”á»ááŸ’áá‡áŸ á‡áŸá“á“á¸', sex: 'F' },
        { id: '14', name: 'áƒá»á“ á‘áŸá–á¸', sex: 'F' }, { id: '62', name: 'ášá·á‘áŸ’á’á¸ á–á·áŸáŸ’áŸá»ááŸá»á€áŸ’ášá¹á', sex: 'M' },
        { id: '49', name: 'á„á·á“ á‘áŸ€á“áœá·á“', sex: 'M' }, { id: '107', name: 'áŸá»á—á€áŸ’ášáŸ áœášáŸˆáŸá·á‘áŸ’á’', sex: 'M' },
        { id: '170', name: 'á¢á»á›áœá¿á“ áŠá¶áœá¸á“', sex: 'F' }, { id: '137', name: 'áŸá¿á“ á…á¶á“áŸ‹áŸá»á˜áŸá’á¶', sex: 'F' },
        { id: '1', name: 'á”áŸŠá»á“ášá¸á“ ááŸá˜ášá¶', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(ášáŸáŸ€á›)': [
        { id: '54', name: 'á™á“áŸ‹ á›á¸á áŸá„', sex: 'M' }, { id: '75', name: 'áœá·á“ á”á‰áŸ’á‰á¶áœáŸá“áŸ’á', sex: 'M' },
        { id: '90', name: 'áŸá¼ ášáŸáŸ’á˜á¸á–á“á·áá¶', sex: 'F' }, { id: '50', name: 'áŸá¼á™ ášá€áŸ’áŸá¶', sex: 'M' },
        { id: '72', name: 'á¢áŸŠá¼ áŸá»áá¢á¶á˜á¸', sex: 'F' }, { id: '137', name: 'áŸá¿á“ á…á¶á“áŸ‹áŸá»á˜áŸá’á¶', sex: 'F' },
        { id: '176', name: 'á”áŸ‰á¹á˜ á˜áŸ‰á¸á‡á¼', sex: 'F' }, { id: '85', name: 'áŸáŸášá¸ á…á“áŸ’á‘áœáŒáŸ’áá“á¶', sex: 'M' },
        { id: '161', name: 'á›á¸á˜ á áŸŠá¸á”áŸ‰', sex: 'M' }, { id: '55', name: 'á¢áŸŠá¶ á‡á¸á„á áŸáš', sex: 'F' },
        { id: '79', name: 'á˜á·ááŸ’á á˜áŸ‰áŸá„á áŸá„', sex: 'M' }, { id: '74', name: 'á…á¶á“áŸ‹á“á¸â€‹ áŸáŸŠá¼áŸá¶á“áŸ‹áá¶', sex: 'F' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(á–áŸ’ášá¹á€)': [
        { id: '75', name: 'á†á“ áœá·ášáŸˆáŸá·á‘áŸ’á’', sex: 'M' }, { id: '47', name: 'á‡á¶á¡á·á… á€á¼á›á¸á“', sex: 'M' },
        { id: '92', name: 'áŸá»á”á‰áŸ’á‰á¶ áŸáŸ„á˜áŸ‰á¶', sex: 'F' }, { id: '83', name: 'á—áºá“ áá·ášá¶á™á»', sex: 'M' },
        { id: '69', name: 'á›á¸ á†á¶á™áˆáŸá“', sex: 'M' }, { id: '77', name: 'áœá»áŒáŸ’áá¸ áŠá¶áœá¸á€á¶', sex: 'F' },
        { id: '93', name: 'á¢áŸŠá¹á˜ ášáŸ„á…á“á¶', sex: 'F' }, { id: '72', name: 'áœá„áŸ’áŸ áŠá¶ášáŸ‰á¶áœá¸á“', sex: 'M' },
        { id: '95', name: 'á…á¶áœ áœá·á“á á¶áœ', sex: 'M' }, { id: '80', name: 'á„á½á“ á”á‰áŸ’á‰á¶á–á»á‘áŸ’á’á·áŸáŸá€áŸ’áá·', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(ášáŸáŸ€á›)': [
        { id: '88', name: 'á…áŸ†ášá¾á“ á…á“áŸ’á‘á§ááŸ’áá˜', sex: 'M' }, { id: '91', name: 'á”áŸŠá¼ áŸá¶á’á»á€á¶áš', sex: 'F' },
        { id: '82', name: 'áŸáŸá“ á™áŸ‰á¶áŸáŸ’á˜á¸á“áá¶', sex: 'F' }, { id: '85', name: 'áŠá“ áŸá»á—áŸááŸ’áŒá˜áŸ‰á¼á“á¸á€á¶', sex: 'F' },
        { id: '78', name: 'áŸáŸŠáŸ’ášá¶á„ áŸáŸ€áœá áŸ’áœá»á„', sex: 'F' }, { id: '73', name: 'á áŸá„ á˜áŸ‰á¸á¢áŸŠá·', sex: 'F' },
        { id: '74', name: 'á¢á¿á“ á–áŸ…áœá›áŸá€áŸ’á', sex: 'F' }, { id: '70', name: 'ášáŸááŸ’á“ ášáŸ‰á¶ááŸá”', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(á–áŸ’ášá¹á€)': [
        { id: '21', name: 'á…á“áŸ’áá¶ á›á¸áá¶', sex: 'F' }, { id: '20', name: 'á–áŸ… áŸá»áá…á·á“', sex: 'M' },
        { id: '17', name: 'áá¶ášáŸ‰á¶ á áŸá„á›á¸', sex: 'M' }, { id: '23', name: 'áŸá»á áŸá˜áŸ’á”ááŸ’áá·', sex: 'M' },
        { id: '22', name: 'áŸá»á áŠá¶á›á¸áŸ', sex: 'F' }, { id: '29', name: 'áŸáŸ’ášáŸáŸ‹ ášá¸á áŸ’áŸá¶', sex: 'F' },
        { id: '41', name: 'á”áŸ‰á»á“ ášá¸á™áŸ‰á¶', sex: 'F' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(ášáŸáŸ€á›)': [
        { id: '59', name: 'á¢á»á„ á”á‰áŸ’á‰á¶ášáŸááŸ’á“', sex: 'M' }, { id: '31', name: 'á˜á·ááŸ’á á˜áŸ‰áŸá„á á½áš', sex: 'M' },
        { id: '14', name: 'á™áŸáŸ‹ á“ášá·á“áŸ’á‘', sex: 'M' }, { id: '33', name: 'áœá„áŸ‹ á–á»á‘áŸ’á’á·áá¶', sex: 'F' },
        { id: '62', name: 'áŸá¼á™ á”á‰áŸ’á‰á¶', sex: 'M' }, { id: '40', name: 'áŸáŸá„ áŸá¶áá¶', sex: 'F' },
        { id: '39', name: 'á…á“áŸ’á‘ áŸá»á•á¶á™áŸ‰á¶á˜áŸáƒ', sex: 'M' }, { id: '30', name: 'áŸáŸŠá“áœá¸ášáŸˆ á”á‰áŸ’á‰á¶á‘áŸá–á¸', sex: 'F' },
        { id: '27', name: 'á”áŸŠá¼ áá¶á˜áŸ‰á¶', sex: 'M' }, { id: '65', name: 'á€áŸ‚áœ á˜á»á“áŸ’á“á¸á§ááŸ’áá˜', sex: 'M' },
        { id: '56', name: 'áœá“áŸ’ááœá·á“ áá¶áá¶', sex: 'F' }, { id: '36', name: 'á á¶á“ áŸáŸŠá¸áœá áŸáš', sex: 'F' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ£(ášáŸáŸ€á›)': [
        { id: '9', name: 'á€áŸ‚áœ áœá¸á“áŸá»á§ááŸ’ááá¶ášá¶', sex: 'F' }, { id: '28', name: 'áˆá»á“áá¶ ášáá“áŸˆáá»á“áŠá¼', sex: 'F' },
        { id: '10', name: 'á™áŸ‰á¶ á–áŸá‡áŸ’ášá˜áŸ‰á¼á“á¸á€á¶', sex: 'F' }, { id: '15', name: 'á›á¸á˜ á–á»á‘áŸ’á’á·ášá¶á‡', sex: 'M' },
        { id: '3', name: 'á¡ áŸáŸŠá¸áœá áŸŠá½á™', sex: 'F' }, { id: '2', name: 'á¡á¶á™ á˜á»á“á·á…á·á“áŸ’áŠá¶', sex: 'F' },
        { id: '24', name: 'á¢áŸ„á€ á“á·áŸá·áŸ’áŸá', sex: 'M' }, { id: '44', name: 'á…áŸ†ášá¾á“ á˜áŸ‰á¶á“á¸áá¶', sex: 'F' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¤ áŸ¥': [
        { id: '1', name: 'á¡á¶á™ á—á¶ášáŸ‰á¶áŠá¶áœá¸áŒ', sex: 'M' }, { id: '42', name: 'áœá„áŸ’áŸ á˜á»á“á¸á€á‰áŸ’á…á“á¶', sex: 'F' },
        { id: '43', name: 'á–áŸ… áŸá»á“á¸áá¶', sex: 'F' }, { id: '4', name: 'á¡ áŸá»áœááŸ’áá á¶á“áŸ‹áá¶', sex: 'F' }
    ],
    'Fount1 mooning': [
        { id: '82', name: 'ášá»á“ ášáŸáŸ’á˜á¸', sex: 'M' }, { id: '149', name: 'á’á¸ áŸá»áœááŸ’á áŸá·á‘áŸ’á’á·á€á¶', sex: 'F' },
        { id: '143', name: 'á•á“ áŸá»áá áŸ€á„', sex: 'M' }, { id: '133', name: 'áŸá»á‘áŸ’á’ á›á¸á“á”áŸ’ášá»áŸáŸá·á‘áŸ’á’', sex: 'M' },
        { id: '134', name: 'á¢áŸŠá¶á” á›á¸á™á¸á„', sex: 'F' }, { id: '88', name: 'á…áŸ†ášá¾á“ á…á“áŸ’á‘á§ááŸ’áá˜', sex: 'M' },
        { id: '127', name: 'á á˜ á…á¶á“áŸ‹á”á»ášá¸ášá€áŸ’áŸ', sex: 'M' }, { id: '182', name: 'áá¶áŸ†á„ á áŸŠá½á™á›á¸á“', sex: 'F' }
    ],
    'Fount1 Evening': [
        { id: '116', name: 'á†á“ á˜áŸ‰áŸá„áŸáŸŠá¸á“', sex: 'M' }, { id: '58', name: 'á„á½á“ á‚á¸á˜á á¶á”áŸ‹', sex: 'M' },
        { id: '145', name: 'á†á¶á™ á—á¸á„á¢áŸŠá¸á„', sex: 'F' }, { id: '125', name: 'á”á‰áŸ’á‰á¶ á—áŸááŸ’ášá¶', sex: 'F' },
        { id: '90', name: 'á…áŸ†ášá¾á“ ášá¿á“ášá¹á‘áŸ’á’á·ášá¶á‡', sex: 'M' }, { id: '159', name: 'áá“ áŸáŸŠá¸á áŸ’á‚áŸ’áŸá·á…', sex: 'F' }
    ],
    'Nursery(á–áŸ’ášá¹á€)': [
        { id: '148', name: 'á”áŸášáŸ‰áŸáŸ á˜áŸ‰áŸƒáƒá¾áŸ', sex: 'M' }, { id: '144', name: 'á áŸá„ áŸá“áŸ’áá·á—á¶á–', sex: 'M' },
        { id: '157', name: 'áŠá½á„ áŸá»á˜áŸá’á¶', sex: 'M' }, { id: '183', name: 'áá»á„ á áŸ’áœá»á„á˜áŸ‰áŸá„', sex: 'M' },
        { id: '158', name: 'á–á“áŸ’á›á€ áœá·ášáŸá·á‘áŸ’á’', sex: 'M' }, { id: '172', name: 'ášáá“á¶ áŸáŸ€áœá›á·', sex: 'F' },
        { id: '180', name: 'ášáŸ‰á¶ááŸ‹ á–áŸá‡áŸ’ášá˜ášá€á', sex: 'F' }, { id: '178', name: 'á›á¸áœá‘áŸ’á’á¸ á‡á»áá·á˜á¶', sex: 'F' },
        { id: '184', name: 'á á¼ á›á¸á—á¸á„', sex: 'M' }, { id: '174', name: 'áœá·á…áŸ’á†á·á€á¶ á˜á»á“áŸ’á“á¸á‘áŸá–á¸', sex: 'F' },
        { id: '185', name: 'á™á¹á˜ á–á»á‘áŸ’á’á·áœá„áŸ’áŸ', sex: 'M' }, { id: '171', name: 'áŸá»á„ áŸá·ášá¸á”á»ááŸ’áš', sex: 'M' }
    ],
    'Nursery(ášáŸáŸ€á›)': [
        { id: '148', name: 'á”áŸášáŸ‰áŸáŸ á˜áŸ‰áŸƒáƒá¾áŸ', sex: 'M' }, { id: '147', name: 'áŸá»á—áŸá€áŸ’áš áœá¸ášá”á»ááŸ’áš', sex: 'M' },
        { id: '150', name: 'áœáŸ‰áŸá á“á¸ášá¸áá¶', sex: 'F' }, { id: '166', name: 'á›á¸áá¶ á á»á„áŸáŸá€áŸ’á€á·á¢á’á·á—á¼', sex: 'M' }
    ],
    'Fount2': [
        { id: '86', name: 'á’áŸá„ á˜áŸ‰áŸá„á›á¸', sex: 'M' }, { id: '00', name: 'áŸáŸŠáŸ’ášá¶á„ áŸáŸ€áœá áŸ’áœá»á„', sex: 'F' },
        { id: '00', name: 'á áŸá„ á˜áŸ‰á¸á¢áŸŠá·', sex: 'F' }, { id: '00', name: 'á¢á¿á“ á–áŸ…áœá›áŸá€áŸ’á', sex: 'F' },
        { id: '00', name: 'á á¶á“ áŸáŸŠá¸áœá áŸáš', sex: 'F' }, { id: '00', name: 'ášáŸááŸ’á“ áŸá»áœááŸ’áá…áŸá“áŸ’á‘áá¶á€á¶', sex: 'M' },
        { id: '00', name: 'á…áŸ†ášá¾á“ á˜áŸ‰á¶á“á¸áá¶ ', sex: 'F' }, { id: '70', name: 'ášáŸááŸ’á“ ášáŸ‰á¶ááŸá”', sex: 'M' }
    ],
    'Fount2(narein)': [
        { id: '68', name: 'áŸá»á„ ášá¹á‘áŸ’á’áŸáŸá€áŸ’á€', sex: 'M' }, { id: '00', name: 'á–áŸ… áŸá»áá…á·á“', sex: 'M' },
        { id: '66', name: 'á”áŸŠá»á“á¡áŸá„ á¢áŸŠáŸƒáŠá¹á€', sex: 'M' }, { id: '67', name: 'á—áŸ„á‚ áŸáŸ’á–á¸ááŒá¸', sex: 'M' },
        { id: '00', name: 'á¢áŸŠá¹á˜ ášáŸ„á…á“á¶', sex: 'F' }, { id: '00', name: 'á„á½á“ á”á‰áŸ’á‰á¶á–á»á‘áŸ’á’á·áŸáŸá€áŸ’áá·', sex: 'M' },
        { id: '00', name: 'á‡á¶á¡á·á… á€á¼á›á¸á“', sex: 'M' }, { id: '00', name: 'áá¶ášáŸ‰á¶ á áŸá„á›á¸', sex: 'M' },
        { id: '00', name: 'á†á“ áœá·ášáŸˆáŸá·á‘áŸ’á’', sex: 'M' }, { id: '00', name: 'áŸá»á áŸá˜áŸ’á”ááŸ’áá·', sex: 'M' },
        { id: '00', name: 'áŸá»á áŠá¶á›á¸áŸ', sex: 'F' }, { id: '00', name: 'á…á¶áœ áœá·á“á á¶áœ', sex: 'M' },
        { id: '00', name: 'á›á¸ á†á¶á™áˆáŸá“á”', sex: 'M' }
    ],
    'Level1': [
        { id: '00', name: 'á¢áŸ„á€ á§ááŸ’áá˜', sex: 'M' }, { id: '00', name: 'áá¶ášáŸ‰á¶ á áŸá„á¡á¶á™', sex: 'M' },
        { id: '62', name: 'áˆá¼á€ áˆá·á“á¡á»á„', sex: 'M' }, { id: '00', name: 'á–áŸ… áŸá»á“á¸áá¶', sex: 'F' },
        { id: '00', name: 'á€áŸ‚áœ áœá¸á“áŸá»á§ááŸ’ááá¶ášá¶', sex: 'F' }, { id: '00', name: 'áˆá»á“áá¶ ášáá“áŸˆáá»á“áŠá¼', sex: 'F' },
        { id: '64', name: 'á›á¶á„ áœáŒáŸ’áƒá“á’á“á»', sex: 'M' }, { id: '00', name: 'á™áŸ‰á¶ á–áŸá‡áŸ’ášá˜áŸ‰á¼á“á¸á€á¶', sex: 'F' },
        { id: '00', name: 'á›á¸á˜ á–á»á‘áŸ’á’á·ášá¶á‡', sex: 'M' }, { id: '00', name: 'á¡ áŸáŸŠá¸áœá áŸŠá½á™', sex: 'F' },
        { id: '00', name: 'á¡á¶á™ á˜á»á“á·á…á·á“áŸ’áŠá¶', sex: 'F' }, { id: '00', name: 'á¢áŸ„á€ á“á·áŸá·áŸ’áŸá', sex: 'M' },
        { id: '00', name: 'á…á“áŸ’á‘ áŸá»á•á¶á™áŸ‰á¶á˜áŸáƒ', sex: 'M' }, { id: '00', name: 'áŸáŸŠá“áœá¸ášáŸˆ á”á‰áŸ’á‰á¶á‘áŸá–á¸', sex: 'F' }
    ],
    'Level2': [
        { id: '48', name: 'áŸá»á—á€áŸ’áŠá· á‘á·ááŸ’ášáŠá¶áá¶', sex: 'F' }, { id: '63', name: 'á“á¿á“ áœáŒáŸ’áá“áŸ‡', sex: 'M' },
        { id: '49', name: 'áŸá»á—á€áŸ’áŠá· ášáá“', sex: 'M' }, { id: '61', name: 'á•á›â€‹ áŸá»áœááŸ’á', sex: 'M' },
        { id: '53', name: 'á á»á„ áŸá·á‘áŸ’á’á·áá¶á›áŸ‹', sex: 'M' }, { id: '55', name: 'á’áŸá„ á‡á¼á›á¸á‰', sex: 'F' },
        { id: '1', name: 'á¡á¶á™ á—á¶ášáŸ‰á¶áŠá¶áœá¸áŒ', sex: 'M' }, { id: '4', name: 'á¡ áŸá»áœááŸ’áá á¶á“áŸ‹áá¶', sex: 'F' }
    ],
    'á˜ááŸ’áŠáŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(á–áŸ’ášá¹á€)': [
        { id: '147', name: 'áŸá»á—á€áŸ’áš áœá¸ášá”á»ááŸ’áš', sex: 'M' }, { id: '166', name: 'á›á¸áá¶ ášáŸááŸ’á“á á»á„áŸáŸá€áŸ’á€á·á¢á’á·á—á¼', sex: 'M' },
        { id: '160', name: 'áá¼ áŸá·á‘áŸ’á’á¸á™á¼áá¶', sex: 'F' }, { id: '175', name: 'áŸá»á‚á“áŸ’á’ á”á‰áŸ’á‰á¶áŸáŸá€', sex: 'M' },
        { id: '000', name: 'áŸá»á¸á˜ áŸášá§ááŸ’áá˜', sex: 'M' },{ id: '000' , name: 'á“á·á áŸá»á’á¶ášá¶á‡',  sex:'M'},
        { id: '000', name: 'áœáŸ‰áŸá á“á¸ášá¸áá¶', sex: 'F' }
    ],
    'á˜ááŸ’áŠáŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(ášáŸáŸ€á›)':[
        { id: '175', name: 'á áŸá„ á‡áŸášá˜á»á¸á„', sex: 'F' }, { id: '000', name: 'áŸá¶á™ áŸá»áá áŸá„', sex: 'M' },
        { id: '181', name: 'áˆá“ á…áŸáŸáŸ’áŠá¶', sex: 'M' }, { id: '000', name: 'á›á¶á„ á›á€áŸ’áŸá»á·á€á‰áŸ’á…á“á¶', sex: 'M' },
        { id: '177', name: 'áœá¶áŸá“á¶ á–áŸá‡áŸ’ášáŸá»á˜áŸ‰á¶á›á¸', sex: 'F' }
    ]
};

const classChatIds = {
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(á–áŸ’ášá¹á€)': '-4845440768',
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(ášáŸáŸ€á›)': '-4845440768',
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(á–áŸ’ášá¹á€)': '-4828804361',
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(ášáŸáŸ€á›)': '-4828804361', 
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(á–áŸ’ášá¹á€)': '-4936041559',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(ášáŸáŸ€á›)': '-4936041559',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(á–áŸ’ášá¹á€)': '-4953929888',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(ášáŸáŸ€á›)': '-4953929888',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ£(ášáŸáŸ€á›)': '-4872387682',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¤ áŸ¥': '-4844052526',
    'Fount1 mooning': '-4986675448',
    'Fount1 Evening': '-4986675448',
    'Nursery(á–áŸ’ášá¹á€)': '-4924159874',
    'Nursery(ášáŸáŸ€á›)': '-4924159874',
    'Fount2': '-4871212513',
    'Fount2(narein)': '-4871212513',
    'Level1': '-4906276801',
    'Level2': '-968404918',
    'á˜ááŸ’áŠáŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(á–áŸ’ášá¹á€)': '-4835279036',
    'á˜ááŸ’áŠáŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(ášáŸáŸ€á›)': '-4835279036'
};

const TELEGRAM_BOT_TOKEN = '8501623225:AAGu-F_GHSQ-dLBrEME7eidOpW2yDf3qvXw';

// Load studentData from localStorage if it exists
function loadStudentData() {
    const saved = localStorage.getItem('studentDataMIKIDS');
    if (saved) {
        try {
            const parsed = JSON.parse(saved);
            // Merge saved data with default data
            Object.keys(parsed).forEach(className => {
                studentData[className] = parsed[className];
            });
            console.log('âœ… Loaded student data from localStorage');
        } catch (e) {
            console.error('Error loading student data:', e);
        }
    }
}

// Save studentData to localStorage
function saveStudentData() {
    try {
        localStorage.setItem('studentDataMIKIDS', JSON.stringify(studentData));
        console.log('ğŸ’¾ Saved student data to localStorage');
    } catch (e) {
        console.error('Error saving student data:', e);
    }
}

// ========== STATISTICS REPORT DATA ==========
let reports = [];
let editingIndex = -1;
let newStudentsArray = [];
let leftStudentsArray = [];

// ========== MAIN TAB SWITCHING ==========
function switchMainTab(tabName) {
    document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.main-tab-content').forEach(t => t.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName + '-system').classList.add('active');
}

// ========== ATTENDANCE SYSTEM FUNCTIONS ==========
document.getElementById('attDate').valueAsDate = new Date();
const classListDiv = document.getElementById('classList');

Object.keys(studentData).forEach((className, index) => {
    const div = document.createElement('div');
    div.className = `class-item ${index === 0 ? 'active' : ''}`;
    div.innerText = className;
    div.onclick = () => selectClass(div, className);
    classListDiv.appendChild(div);
});

function selectClass(element, className) {
    document.querySelectorAll('.class-item').forEach(i => i.classList.remove('active'));
    element.classList.add('active');
    document.getElementById('displayClass').innerText = className;
    renderStudents(className);
}

function renderStudents(className) {
    const container = document.getElementById('studentContainer');
    container.innerHTML = "";
    const students = studentData[className] || [];
    
    students.forEach(s => {
        const card = document.createElement('div');
        card.className = 'student-card';
        card.setAttribute('data-name', s.name);
        card.innerHTML = `
            <div class="student-id">${s.id}</div>
            <div class="student-info">
                <div class="student-name">${s.name}</div>
                <div class="student-sex">Sex: ${s.sex === 'M' ? 'Male' : 'Female'}</div>
            </div>
            <div class="attendance-btns">
                <button class="btn-att present" onclick="mark(this, 'âœ”ï¸')">âœ”ï¸</button>
                <button class="btn-att permission" onclick="mark(this, 'P')">P</button>
                <button class="btn-att absent" onclick="mark(this, 'A')">A</button>
            </div>
        `;
        container.appendChild(card);
    });
    calculateSummary();
}

function mark(btn, type) {
    const parent = btn.parentElement;
    parent.querySelectorAll('.btn-att').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    calculateSummary();
}

function calculateSummary() {
    document.getElementById('cP').innerText = document.querySelectorAll('.btn-att.present.active').length;
    document.getElementById('cL').innerText = document.querySelectorAll('.btn-att.permission.active').length;
    document.getElementById('cA').innerText = document.querySelectorAll('.btn-att.absent.active').length;
    document.getElementById('cT').innerText = document.querySelectorAll('.student-card').length;
}

function exportToExcel() {
    const activeClass = document.querySelector('.class-item.active');
    if(!activeClass) return alert("áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹á‡á¶á˜á»á“áŸá·á“!");
    
    const className = activeClass.innerText;
    const date = document.getElementById('attDate').value;
    
    let csv = "\uFEFFááŸ’á„áŸƒááŸ‚,ááŸ’á“á¶á€áŸ‹,ID,áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ,áŸáŸ’áá¶á“á—á¶á–\n";
    
    document.querySelectorAll('.student-card').forEach((card) => {
        let status = "-";
        if(card.querySelector('.btn-att.present').classList.contains('active')) status = "âœ”ï¸ á˜á€";
        if(card.querySelector('.btn-att.permission').classList.contains('active')) status = "P á…áŸ’á”á¶á”áŸ‹";
        if(card.querySelector('.btn-att.absent').classList.contains('active')) status = "A á¢áœááŸ’áá˜á¶á“";
        
        const id = card.querySelector('.student-id').innerText;
        const name = card.getAttribute('data-name');
        csv += `${date},${className},${id},${name},${status}\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `Attendance_${className}_${date}.csv`;
    link.click();
}

async function sendAttendanceToTelegram() {
    const activeClass = document.querySelector('.class-item.active');
    if (!activeClass) return alert("áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹á‡á¶á˜á»á“áŸá·á“!");

    const className = activeClass.innerText;
    const chatId = classChatIds[className];
    
    if (!chatId) {
        return alert(`âŒ ášá€á˜á·á“áƒá¾á‰ Chat ID áŸá˜áŸ’ášá¶á”áŸ‹ááŸ’á“á¶á€áŸ‹: "${className}"`);
    }

    const date = document.getElementById('attDate').value;
    let presentCount = document.getElementById('cP').innerText;
    let leaveCount = document.getElementById('cL').innerText;
    let absentCount = document.getElementById('cA').innerText;
    let total = document.getElementById('cT').innerText;

    let message = `ğŸ“Š *ášá”á¶á™á€á¶ášááŸáŸá·áŸáŸ’áŸáœááŸ’áá˜á¶á“ á“á·á„á…áŸ’á”á¶á”áŸ‹*\n`;
    message += `ğŸ“… á€á¶á›á”ášá·á…áŸ’á†áŸá‘: ${date}\n`;
    message += `ğŸ« ááŸ’á“á¶á€áŸ‹: *${className}*\n`;
    message += `ğŸ‘¥ áŸášá»á”: ${total} á“á¶á€áŸ‹\n`;
    message += `--------------------------\n`;
    
    let hasMissingStudents = false;
    let studentList = "";

    document.querySelectorAll('.student-card').forEach((card) => {
        let statusText = "";
        const isLeave = card.querySelector('.btn-att.permission').classList.contains('active');
        const isAbsent = card.querySelector('.btn-att.absent').classList.contains('active');
        
        if (isLeave) statusText = " á…áŸ’á”á¶á”áŸ‹ (P)";
        if (isAbsent) statusText = " á¢áœááŸ’áá˜á¶á“ (A)";

        if (statusText !== "") {
            const name = card.getAttribute('data-name');
            const id = card.querySelector('.student-id').innerText;
            studentList += `ğŸ†” ${id}. ${name} => ${statusText}\n`;
            hasMissingStudents = true;
        }
    });

    if (!hasMissingStudents) {
        message += `âœ… áŸá·áŸáŸ’áŸá˜á€ášáŸ€á“á‚áŸ’ášá”áŸ‹á…áŸ†á“á½á“ (á‚áŸ’á˜á¶á“áŸá·áŸáŸ’áŸá¢áœááŸ’áá˜á¶á“)\n`;
    } else {
        message += studentList;
    }

    message += `--------------------------\n`;
    message += `âœ… á˜á€: ${presentCount} á“á¶á€áŸ‹\n`;
    message += `ğŸŸ¡ á…áŸ’á”á¶á”áŸ‹ (P): ${leaveCount} á“á¶á€áŸ‹\n`;
    message += `ğŸ”´ á¢áœááŸ’áá˜á¶á“ (A): ${absentCount} á“á¶á€áŸ‹\n`;

    const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
    
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: chatId,
                text: message,
                parse_mode: 'Markdown'
            })
        });

        const result = await response.json();
        
        if (response.ok) {
            alert("âœ… á”á¶á“á•áŸ’á‰á¾ášá”á¶á™á€á¶ášááŸáœááŸ’áá˜á¶á“á‘áŸ… Telegram ášá½á…ášá¶á›áŸ‹!");
        } else {
            console.error("Telegram Error:", result);
            alert(`âŒ á”ášá¶á‡áŸá™! ${result.description || 'áŸá¼á˜á–á·á“á·ááŸ’á™ Bot Token á¬ Chat ID'}`);
        }
    } catch (error) {
        console.error("Network Error:", error);
        alert("âŒ á˜á¶á“á”á‰áŸ’á á¶á”á…áŸ’á…áŸá€á‘áŸáŸá€áŸ’á“á»á„á€á¶ášá•áŸ’á‰á¾!");
    }
}

// ========== STATISTICS REPORT FUNCTIONS ==========
function loadReports() {
    const saved = localStorage.getItem('studentReports');
    if (saved) {
        reports = JSON.parse(saved);
    }
}

function saveReports() {
    localStorage.setItem('studentReports', JSON.stringify(reports));
}

function switchStatsTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName + '-tab').classList.add('active');

    if (tabName === 'view') {
        displayReports();
    } else if (tabName === 'summary') {
        displaySummary();
    } else if (tabName === 'create') {
        populateClassDropdowns();
        // Auto-fill today's date
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('reportDate').value = today;
    }
}

// Populate class dropdowns
function populateClassDropdowns() {
    const newClassSelect = document.getElementById('newStudentClass');
    const leftStudentSelect = document.getElementById('leftStudentSelect');
    
    // Populate new student class dropdown
    newClassSelect.innerHTML = '<option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>';
    Object.keys(studentData).forEach(className => {
        const option = document.createElement('option');
        option.value = className;
        option.textContent = className;
        newClassSelect.appendChild(option);
    });
    
    // Populate left student dropdown with all students
    leftStudentSelect.innerHTML = '<option value="">-- á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ --</option>';
    Object.keys(studentData).forEach(className => {
        studentData[className].forEach(student => {
            const option = document.createElement('option');
            option.value = JSON.stringify({name: student.name, class: className, id: student.id});
            option.textContent = `${student.name} (${className})`;
            leftStudentSelect.appendChild(option);
        });
    });
}

// Add new student
function addNewStudent() {
    const className = document.getElementById('newStudentClass').value;
    const name = document.getElementById('newStudentName').value.trim();
    const gender = document.getElementById('newStudentGender').value;
    const date = document.getElementById('newStudentDate').value;
    
    if (!className || !name || !gender || !date) {
        alert('áŸá¼á˜á”áŸ†á–áŸá‰á–áŸááŸŒá˜á¶á“á²áŸ’á™á”á¶á“á‚áŸ’ášá”áŸ‹á‚áŸ’ášá¶á“áŸ‹!');
        return;
    }
    
    newStudentsArray.push({
        name: name,
        class: className,
        gender: gender,
        date: date
    });
    
    console.log('â• Added new student:', name);
    console.log('Total new students:', newStudentsArray.length);
    
    // IMMEDIATELY add to attendance system studentData
    if (!studentData[className]) {
        studentData[className] = [];
    }
    
    const newStudentForAttendance = {
        id: Date.now().toString().slice(-3), // Generate 3-digit ID
        name: name,
        sex: gender
    };
    
    studentData[className].push(newStudentForAttendance);
    console.log('âœ… Added to attendance system:', newStudentForAttendance);
    
    // Save to localStorage so it persists
    saveStudentData();
    
    // Refresh left student dropdown to include new student
    populateClassDropdowns();
    
    // Update total students count
    const currentTotal = parseInt(document.getElementById('totalStudents').value) || 0;
    document.getElementById('totalStudents').value = currentTotal + 1;
    
    // Clear inputs
    document.getElementById('newStudentName').value = '';
    document.getElementById('newStudentGender').value = '';
    document.getElementById('newStudentDate').value = '';
    
    // Update display
    displayNewStudents();
    
    // Refresh attendance list if currently viewing that class
    const activeClassElement = document.querySelector('.class-item.active');
    if (activeClassElement && activeClassElement.innerText === className) {
        renderStudents(className);
    }
}

// Display new students list
function displayNewStudents() {
    const container = document.getElementById('newStudentsList');
    if (newStudentsArray.length === 0) {
        container.innerHTML = '';
        return;
    }
    
    container.innerHTML = newStudentsArray.map((student, index) => `
        <div class="student-entry">
            <div class="student-entry-info">
                <div class="student-entry-name">${student.name}</div>
                <div class="student-entry-details">ááŸ’á“á¶á€áŸ‹: ${student.class} | á—áŸá‘: ${student.gender === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'} | ááŸ’á„áŸƒá…á¼á›: ${student.date}</div>
            </div>
            <button class="btn-remove" onclick="removeNewStudent(${index})">á›á»á”</button>
        </div>
    `).join('');
}

// Remove new student
function removeNewStudent(index) {
    // Subtract 1 from total before removing
    const currentTotal = parseInt(document.getElementById('totalStudents').value) || 0;
    document.getElementById('totalStudents').value = Math.max(0, currentTotal - 1);
    
    newStudentsArray.splice(index, 1);
    displayNewStudents();
}

// Add left student
function addLeftStudent() {
    const studentJson = document.getElementById('leftStudentSelect').value;
    const date = document.getElementById('leftStudentDate').value;
    
    if (!studentJson || !date) {
        alert('áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ á“á·á„á€á¶á›á”ášá·á…áŸ’á†áŸá‘!');
        return;
    }
    
    const student = JSON.parse(studentJson);
    
    // Check if already added
    if (leftStudentsArray.find(s => s.name === student.name && s.class === student.class)) {
        alert('áŸá·áŸáŸ’áŸá“áŸáŸ‡ááŸ’ášá¼áœá”á¶á“á”á“áŸ’ááŸ‚á˜ášá½á…á á¾á™!');
        return;
    }
    
    leftStudentsArray.push({
        name: student.name,
        class: student.class,
        id: student.id,
        date: date
    });
    
    console.log('â– Added left student:', student.name);
    console.log('Total left students:', leftStudentsArray.length);
    
    // Subtract from total students count
    const currentTotal = parseInt(document.getElementById('totalStudents').value) || 0;
    document.getElementById('totalStudents').value = Math.max(0, currentTotal - 1);
    
    // Clear inputs
    document.getElementById('leftStudentSelect').value = '';
    document.getElementById('leftStudentDate').value = '';
    
    // Update display
    displayLeftStudents();
}

// Display left students list
function displayLeftStudents() {
    const container = document.getElementById('leftStudentsList');
    if (leftStudentsArray.length === 0) {
        container.innerHTML = '';
        return;
    }
    
    container.innerHTML = leftStudentsArray.map((student, index) => `
        <div class="student-entry">
            <div class="student-entry-info">
                <div class="student-entry-name">${student.name}</div>
                <div class="student-entry-details">ááŸ’á“á¶á€áŸ‹: ${student.class} | ááŸ’á„áŸƒáˆá”áŸ‹: ${student.date}</div>
            </div>
            <button class="btn-remove" onclick="removeLeftStudent(${index})">á›á»á”</button>
        </div>
    `).join('');
}

// Remove left student
function removeLeftStudent(index) {
    // Add 1 back to total before removing (since we subtracted it when adding)
    const currentTotal = parseInt(document.getElementById('totalStudents').value) || 0;
    document.getElementById('totalStudents').value = currentTotal + 1;
    
    leftStudentsArray.splice(index, 1);
    displayLeftStudents();
}

// Update total students automatically
function updateTotalStudents() {
    const currentTotal = parseInt(document.getElementById('totalStudents').value) || 0;
    const newCount = newStudentsArray.length;
    const leftCount = leftStudentsArray.length;
    
    console.log('ğŸ“Š Updating total students:');
    console.log('  Current total:', currentTotal);
    console.log('  New students:', newCount);
    console.log('  Left students:', leftCount);
    
    // Calculate: current + new - left
    const updatedTotal = currentTotal + newCount - leftCount;
    console.log('  Calculated total:', updatedTotal);
    
    document.getElementById('totalStudents').value = Math.max(0, updatedTotal);
}

document.getElementById('reportForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const report = {
        id: editingIndex >= 0 ? reports[editingIndex].id : Date.now(),
        reportDate: document.getElementById('reportDate').value,
        totalStudents: parseInt(document.getElementById('totalStudents').value),
        femaleStudents: parseInt(document.getElementById('femaleStudents').value),
        khmerMorning: parseInt(document.getElementById('khmerMorning').value) || 0,
        khmerAfternoon: parseInt(document.getElementById('khmerAfternoon').value) || 0,
        englishMorning: parseInt(document.getElementById('englishMorning').value) || 0,
        englishAfternoon: parseInt(document.getElementById('englishAfternoon').value) || 0,
        englishBoth: parseInt(document.getElementById('englishBoth').value) || 0,
        khmerBoth: parseInt(document.getElementById('khmerBoth').value) || 0,
        lunchCare: parseInt(document.getElementById('lunchCare').value) || 0,
        trialStudents: parseInt(document.getElementById('trialStudents').value) || 0,
        trialClass: document.getElementById('trialClass').value,
        newStudents: [...newStudentsArray],
        leftStudents: [...leftStudentsArray],
        createdAt: editingIndex >= 0 ? reports[editingIndex].createdAt : new Date().toISOString()
    };

    console.log('=== DEBUG INFO ===');
    console.log('New students count:', newStudentsArray.length);
    console.log('Left students count:', leftStudentsArray.length);
    console.log('New students array:', newStudentsArray);
    console.log('Left students array:', leftStudentsArray);
    console.log('Report object:', report);

    if (editingIndex >= 0) {
        reports[editingIndex] = report;
        editingIndex = -1;
    } else {
        reports.push(report);
    }

    saveReports();
    
    // Send to Telegram if there are new or left students
    if (newStudentsArray.length > 0 || leftStudentsArray.length > 0) {
        console.log('ğŸ“¤ Sending to Telegram...');
        sendStudentChangesToTelegram(report);
    } else {
        console.log('âš ï¸ No new or left students to send');
        alert('á‚áŸ’á˜á¶á“áŸá·áŸáŸ’áŸááŸ’á˜á¸á¬áˆá”áŸ‹ - á˜á·á“á•áŸ’á‰á¾á‘áŸ… Telegram');
    }
    
    alert('ášá€áŸ’áŸá¶á‘á»á€ášá”á¶á™á€á¶ášááŸá”á¶á“á‡áŸ„á‚á‡áŸá™!');
    
    // Only reset new/left students arrays and their displays
    newStudentsArray = [];
    leftStudentsArray = [];
    displayNewStudents();
    displayLeftStudents();
    
    // Clear the input fields for adding new students
    document.getElementById('newStudentClass').value = '';
    document.getElementById('newStudentName').value = '';
    document.getElementById('newStudentGender').value = '';
    document.getElementById('newStudentDate').value = '';
    document.getElementById('leftStudentSelect').value = '';
    document.getElementById('leftStudentDate').value = '';
});

async function sendStudentChangesToTelegram(report) {
    const chatId = '--1003814592979'; // Main admin group
    
    console.log('ğŸ” Building Telegram message...');
    
    let message = `ğŸ“Š *ášá”á¶á™á€á¶ášááŸáŸáŸ’áá·áá·áŸá·áŸáŸ’áŸ*\n\n`;
    
    // 1. áŸá·áŸáŸ’áŸáŸášá»á”
    message += `ğŸ‘¥ *áŸá·áŸáŸ’áŸáŸášá»á”:* ${report.totalStudents} á“á¶á€áŸ‹\n\n`;
    
    // 2. ááŸ’á„áŸƒááŸ‚á†áŸ’á“á¶áŸ†
    message += `ğŸ“… *ááŸ’á„áŸƒááŸ‚á†áŸ’á“á¶áŸ†:* ${report.reportDate}\n\n`;
    
    // 3. áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸
    if (report.newStudents && report.newStudents.length > 0) {
        console.log('Adding new students to message:', report.newStudents);
        message += `âœ… *áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸*\n`;
        report.newStudents.forEach((student, index) => {
            message += `   ${index + 1}. ${student.name}\n`;
            message += `      â€¢ ááŸ’á“á¶á€áŸ‹: ${student.class}\n`;
            message += `      â€¢ á—áŸá‘: ${student.gender === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'}\n`;
        });
        message += `\n`;
    }
    
    // 4. áŸá·áŸáŸ’áŸáˆá”áŸ‹
    if (report.leftStudents && report.leftStudents.length > 0) {
        console.log('Adding left students to message:', report.leftStudents);
        message += `âŒ *áŸá·áŸáŸ’áŸáˆá”áŸ‹*\n`;
        report.leftStudents.forEach((student, index) => {
            message += `   ${index + 1}. ${student.name}\n`;
            message += `      â€¢ ááŸ’á“á¶á€áŸ‹: ${student.class}\n`;
        });
        message += `\n`;
    }
    
    // 5. áŸá·áŸáŸ’áŸá…á¼á›áŸášá»á”
    const newCount = report.newStudents ? report.newStudents.length : 0;
    message += `ğŸ“¥ *áŸá·áŸáŸ’áŸá…á¼á›áŸášá»á”:* ${newCount} á“á¶á€áŸ‹\n`;
    
    // 6. áŸá·áŸáŸ’áŸáˆá”áŸ‹áŸášá»á”
    const leftCount = report.leftStudents ? report.leftStudents.length : 0;
    message += `ğŸ“¤ *áŸá·áŸáŸ’áŸáˆá”áŸ‹áŸášá»á”:* ${leftCount} á“á¶á€áŸ‹`;

    console.log('ğŸ“ Final message:', message);
    console.log('ğŸ“¤ Sending to chat ID:', chatId);

    try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                chat_id: chatId,
                text: message,
                parse_mode: 'Markdown'
            })
        });

        const result = await response.json();
        
        console.log('ğŸ“¬ Telegram API response:', result);
        
        if (result.ok) {
            console.log('âœ… á•áŸ’á‰á¾á–áŸááŸŒá˜á¶á“áŸá·áŸáŸ’áŸá‘áŸ… Telegram á”á¶á“á‡áŸ„á‚á‡áŸá™!');
            alert('âœ… á•áŸ’á‰á¾á–áŸááŸŒá˜á¶á“á‘áŸ… Telegram ášá½á…ášá¶á›áŸ‹!');
        } else {
            console.error('âŒ Telegram error:', result);
            alert('âš ï¸ á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá•áŸ’á‰á¾á‘áŸ… Telegram:\n' + (result.description || 'Unknown error'));
        }
    } catch (error) {
        console.error('âŒ Network error:', error);
        alert('âŒ á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášáá—áŸ’á‡á¶á”áŸ‹á‘áŸ… Telegram:\n' + error.message);
    }
}

function displayReports() {
    const container = document.getElementById('reportsList');
    
    if (reports.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>á˜á·á“á‘á¶á“áŸ‹á˜á¶á“ášá”á¶á™á€á¶ášááŸ</h3>
                <p>áŸá¼á˜á…á»á…á›á¾ "á”á„áŸ’á€á¾áášá”á¶á™á€á¶ášááŸááŸ’á˜á¸" áŠá¾á˜áŸ’á”á¸á”á‰áŸ’á…á¼á›ášá”á¶á™á€á¶ášááŸ</p>
            </div>
        `;
        return;
    }

    const sortedReports = [...reports].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

    container.innerHTML = sortedReports.map((report, index) => {
        const originalIndex = reports.findIndex(r => r.id === report.id);
        const newStudentsCount = Array.isArray(report.newStudents) ? report.newStudents.length : 0;
        const leftStudentsCount = Array.isArray(report.leftStudents) ? report.leftStudents.length : 0;
        
        return `
            <div class="report-card">
                <div class="report-header">
                    <div>
                        <div class="report-title">ášá”á¶á™á€á¶ášááŸááŸ’á„áŸƒá‘á¸ ${report.reportDate}</div>
                    </div>
                </div>
                
                <div class="report-stats">
                    <div class="stat-item">
                        <div class="stat-label">áŸá·áŸáŸ’áŸáŸášá»á”</div>
                        <div class="stat-value">${report.totalStudents} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">áŸá·áŸáŸ’áŸáŸáŸ’ášá¸</div>
                        <div class="stat-value">${report.femaleStudents} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">áœáŸá“á–áŸ’ášá¹á€ (ááŸ’á˜áŸ‚áš)</div>
                        <div class="stat-value">${report.khmerMorning} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">áœáŸá“ášáŸáŸ€á› (ááŸ’á˜áŸ‚áš)</div>
                        <div class="stat-value">${report.khmerAfternoon} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">áœáŸá“á–áŸ’ášá¹á€ (á¢á„áŸ‹á‚áŸ’á›áŸáŸ)</div>
                        <div class="stat-value">${report.englishMorning} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">áœáŸá“ášáŸáŸ€á› (á¢á„áŸ‹á‚áŸ’á›áŸáŸ)</div>
                        <div class="stat-value">${report.englishAfternoon} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">á‘á¶áŸ†á„á–áŸ’ášá¹á€-ášáŸáŸ€á› (á¢á„áŸ‹á‚áŸ’á›áŸáŸ)</div>
                        <div class="stat-value">${report.englishBoth} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">á‘á¶áŸ†á„á–áŸ’ášá¹á€-ášáŸáŸ€á› (ááŸ’á˜áŸ‚áš)</div>
                        <div class="stat-value">${report.khmerBoth} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">á˜á¾á›ááŸ‚ááŸ’á„áŸƒááŸ’ášá„áŸ‹</div>
                        <div class="stat-value">${report.lunchCare} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">áŸá¶á€á›áŸ’á”á„</div>
                        <div class="stat-value">${report.trialStudents} á“á¶á€áŸ‹ ${report.trialClass ? '(' + report.trialClass + ')' : ''}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">á…á¼á›ááŸ’á˜á¸</div>
                        <div class="stat-value">${newStudentsCount} á“á¶á€áŸ‹</div>
                        ${newStudentsCount > 0 && Array.isArray(report.newStudents) ? '<div class="stat-label" style="margin-top: 5px; font-size: 12px;">' + report.newStudents.map(s => s.name + ' (' + s.class + ')').join(', ') + '</div>' : ''}
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">áˆá”áŸ‹</div>
                        <div class="stat-value">${leftStudentsCount} á“á¶á€áŸ‹</div>
                        ${leftStudentsCount > 0 && Array.isArray(report.leftStudents) ? '<div class="stat-label" style="margin-top: 5px; font-size: 12px;">' + report.leftStudents.map(s => s.name + ' (' + s.class + ')').join(', ') + '</div>' : ''}
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-main btn-small btn-danger" onclick="deleteReport(${originalIndex})">á›á»á”</button>
                    <button class="btn-main btn-small btn-secondary" onclick="exportReport(${originalIndex})">á“á¶áŸ†á…áŸá‰</button>
                </div>
            </div>
        `;
    }).join('');
}

function displaySummary() {
    const container = document.getElementById('summaryContent');
    
    if (reports.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á‘á·á“áŸ’á“á“áŸá™áŸá„áŸ’ááŸá”</h3>
                <p>áŸá¼á˜á”á‰áŸ’á…á¼á›ášá”á¶á™á€á¶ášááŸá˜á»á“áŸá·á“</p>
            </div>
        `;
        return;
    }

    const totalReports = reports.length;
    const avgTotal = Math.round(reports.reduce((sum, r) => sum + r.totalStudents, 0) / totalReports);
    const avgFemale = Math.round(reports.reduce((sum, r) => sum + r.femaleStudents, 0) / totalReports);
    const totalNew = reports.reduce((sum, r) => sum + (Array.isArray(r.newStudents) ? r.newStudents.length : 0), 0);
    const totalLeft = reports.reduce((sum, r) => sum + (Array.isArray(r.leftStudents) ? r.leftStudents.length : 0), 0);

    container.innerHTML = `
        <div class="summary-grid-stats">
            <div class="summary-card">
                <h4>á…áŸ†á“á½á“ášá”á¶á™á€á¶ášááŸ</h4>
                <div class="number">${totalReports}</div>
            </div>
            <div class="summary-card">
                <h4>á˜á’áŸ’á™á˜áŸá·áŸáŸ’áŸáŸášá»á”</h4>
                <div class="number">${avgTotal}</div>
            </div>
            <div class="summary-card">
                <h4>á˜á’áŸ’á™á˜áŸá·áŸáŸ’áŸáŸáŸ’ášá¸</h4>
                <div class="number">${avgFemale}</div>
            </div>
            <div class="summary-card">
                <h4>áŸášá»á”áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸</h4>
                <div class="number">${totalNew}</div>
            </div>
            <div class="summary-card">
                <h4>áŸášá»á”áŸá·áŸáŸ’áŸáˆá”áŸ‹</h4>
                <div class="number">${totalLeft}</div>
            </div>
        </div>
    `;
}

function editReport(index) {
    // Removed edit functionality as requested
}

function deleteReport(index) {
    if (confirm('áá¾á¢áŸ’á“á€á”áŸ’ášá¶á€áŠáá¶á…á„áŸ‹á›á»á”ášá”á¶á™á€á¶ášááŸá“áŸáŸ‡á˜áŸ‚á“á‘áŸ?')) {
        reports.splice(index, 1);
        saveReports();
        displayReports();
    }
}

function exportReport(index) {
    const report = reports[index];
    let text = `
ášá”á¶á™á€á¶ášááŸáŸáŸ’áá·áá·áŸá·áŸáŸ’áŸ
ááŸ’á„áŸƒá‘á¸: ${report.reportDate}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š áŸáŸ’áá·áá·áŸá·áŸáŸ’áŸáŸášá»á”:
â€¢ áŸá·áŸáŸ’áŸáŸášá»á”: ${report.totalStudents} á“á¶á€áŸ‹
â€¢ áŸá·áŸáŸ’áŸáŸáŸ’ášá¸: ${report.femaleStudents} á“á¶á€áŸ‹

ğŸ“š áŸáŸ’áá·áá·áá¶á˜áœáŸá“ á“á·á„á—á¶áŸá¶:
â€¢ áœáŸá“á–áŸ’ášá¹á€ (ááŸ’á˜áŸ‚áš): ${report.khmerMorning} á“á¶á€áŸ‹
â€¢ áœáŸá“ášáŸáŸ€á› (ááŸ’á˜áŸ‚áš): ${report.khmerAfternoon} á“á¶á€áŸ‹
â€¢ áœáŸá“á–áŸ’ášá¹á€ (á¢á„áŸ‹á‚áŸ’á›áŸáŸ): ${report.englishMorning} á“á¶á€áŸ‹
â€¢ áœáŸá“ášáŸáŸ€á› (á¢á„áŸ‹á‚áŸ’á›áŸáŸ): ${report.englishAfternoon} á“á¶á€áŸ‹
â€¢ á‘á¶áŸ†á„á–áŸ’ášá¹á€-ášáŸáŸ€á› (á¢á„áŸ‹á‚áŸ’á›áŸáŸ): ${report.englishBoth} á“á¶á€áŸ‹
â€¢ á‘á¶áŸ†á„á–áŸ’ášá¹á€-ášáŸáŸ€á› (ááŸ’á˜áŸ‚áš): ${report.khmerBoth} á“á¶á€áŸ‹

ğŸ½ï¸ áŸáŸáœá¶á€á˜áŸ’á˜:
â€¢ á˜á¾á›ááŸ‚ááŸ’á„áŸƒááŸ’ášá„áŸ‹: ${report.lunchCare} á“á¶á€áŸ‹

ğŸ‘¥ áŸá€á˜áŸ’á˜á—á¶á–:
â€¢ áŸá¶á€á›áŸ’á”á„: ${report.trialStudents} á“á¶á€áŸ‹ ${report.trialClass ? '(' + report.trialClass + ')' : ''}
`;

    if (Array.isArray(report.newStudents) && report.newStudents.length > 0) {
        text += `\nâœ… áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸ (${report.newStudents.length} á“á¶á€áŸ‹):\n`;
        report.newStudents.forEach((student, i) => {
            text += `  ${i + 1}. ${student.name} (${student.class}) - á—áŸá‘: ${student.gender === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'} - ááŸ’á„áŸƒá…á¼á›: ${student.date}\n`;
        });
    }

    if (Array.isArray(report.leftStudents) && report.leftStudents.length > 0) {
        text += `\nâŒ áŸá·áŸáŸ’áŸáˆá”áŸ‹ (${report.leftStudents.length} á“á¶á€áŸ‹):\n`;
        report.leftStudents.forEach((student, i) => {
            text += `  ${i + 1}. ${student.name} (${student.class}) - ááŸ’á„áŸƒáˆá”áŸ‹: ${student.date}\n`;
        });
    }

    text = text.trim();

    const blob = new Blob([text], { type: 'text/plain;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `ášá”á¶á™á€á¶ášááŸ_${report.reportDate}.txt`;
    a.click();
    URL.revokeObjectURL(url);
}

async function sendReportToTelegram(index) {
    // Removed as changes are sent automatically
}

function resetReportForm() {
    document.getElementById('reportForm').reset();
    newStudentsArray = [];
    leftStudentsArray = [];
    displayNewStudents();
    displayLeftStudents();
    editingIndex = -1;
}

// Initialize
window.onload = () => {
    // Load student data from localStorage first
    loadStudentData();
    
    // Initialize attendance system
    const firstClass = Object.keys(studentData)[0];
    if(firstClass) renderStudents(firstClass);
    
    // Initialize statistics system
    loadReports();
    populateClassDropdowns();
    
    // Auto-fill today's date
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('reportDate').value = today;
    
    console.log('ğŸš€ System initialized');
};
</script>

</body>
</html>