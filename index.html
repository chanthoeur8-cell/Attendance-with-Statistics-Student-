<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIKIDS á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áŸá·áŸáŸ’áŸ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Khmer OS Battambang', 'Khmer OS Siemreap', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .main-header {
            background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }

        .main-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .main-header p {
            font-size: 16px;
            opacity: 0.9;
        }

        /* Main Navigation Tabs */
        .main-tabs {
            display: flex;
            background: #f8f9fc;
            border-bottom: 3px solid #e3e6f0;
        }

        .main-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            color: #5a5c69;
            background: #f8f9fc;
            border: none;
            transition: all 0.3s;
            position: relative;
        }

        .main-tab:hover {
            background: #eaecf4;
            color: #4e73df;
        }

        .main-tab.active {
            background: white;
            color: #4e73df;
        }

        .main-tab.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #4e73df;
        }

        .main-tab-content {
            display: none;
        }

        .main-tab-content.active {
            display: block;
        }

        /* ========== ATTENDANCE SYSTEM STYLES ========== */
        .attendance-container {
            display: flex;
            height: calc(100vh - 250px);
            min-height: 600px;
        }

        .sidebar {
            width: 320px;
            background: #f8f9fc;
            padding: 20px;
            border-right: 1px solid #e3e6f0;
            overflow-y: auto;
        }

        .section-title {
            font-weight: bold;
            color: #4e73df;
            margin: 15px 0 10px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e3e6f0;
            font-size: 16px;
        }

        .date-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 2px solid #d1d3e2;
            margin-bottom: 15px;
            font-family: inherit;
            font-size: 15px;
        }

        .class-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .class-item {
            padding: 12px;
            background: white;
            border: 2px solid #d1d3e2;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.2s;
        }

        .class-item:hover {
            background: #eaecf4;
            border-color: #4e73df;
        }

        .class-item.active {
            background: #4e73df;
            color: white;
            border-color: #4e73df;
        }

        .content-area {
            flex: 1;
            padding: 25px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .class-title {
            margin-bottom: 20px;
            color: #4e73df;
            font-size: 22px;
            font-weight: bold;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-box {
            text-align: center;
            padding: 15px;
            background: #f8f9fc;
            border-radius: 10px;
            border: 2px solid #e3e6f0;
        }

        .summary-box .label {
            font-size: 14px;
            color: #5a5c69;
            margin-bottom: 8px;
        }

        .summary-box .count {
            font-size: 28px;
            font-weight: bold;
        }

        .list-header {
            background: #f8f9fc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e3e6f0;
            font-weight: bold;
            color: #5a5c69;
            font-size: 16px;
        }

        #studentContainer {
            flex: 1;
            overflow-y: auto;
            padding-right: 10px;
        }

        .student-card {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #fff;
            border: 2px solid #e3e6f0;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }

        .student-card:hover {
            border-color: #4e73df;
            box-shadow: 0 4px 10px rgba(78, 115, 223, 0.1);
        }

        .student-id {
            font-weight: bold;
            color: #4e73df;
            width: 50px;
            font-size: 16px;
        }

        .student-info {
            flex: 1;
            margin-left: 15px;
        }

        .student-name {
            font-weight: bold;
            font-size: 16px;
            color: #2e59d9;
            margin-bottom: 4px;
        }

        .student-sex {
            font-size: 13px;
            color: #858796;
        }

        .attendance-btns {
            display: flex;
            gap: 10px;
        }

        .btn-att {
            width: 50px;
            height: 50px;
            border: 2px solid #d1d3e2;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            background: #f8f9fc;
            font-size: 18px;
            transition: all 0.2s;
        }

        .btn-att:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn-att.present.active {
            background: #1cc88a !important;
            color: white;
            border-color: #1cc88a;
        }

        .btn-att.permission.active {
            background: #f6c23e !important;
            color: white;
            border-color: #f6c23e;
        }

        .btn-att.absent.active {
            background: #e74a3b !important;
            color: white;
            border-color: #e74a3b;
        }

        .bottom-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-main {
            padding: 15px 20px;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
            font-family: inherit;
        }

        .btn-main:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-telegram {
            background: #0088cc;
        }

        .btn-excel {
            background: #28a745;
        }

        /* ========== STATISTICS REPORT STYLES ========== */
        .stats-container {
            padding: 30px;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            font-size: 16px;
            font-family: inherit;
            cursor: pointer;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 15px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 15px;
            transition: border-color 0.3s;
            resize: vertical;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .report-list {
            margin-top: 30px;
        }

        .report-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .report-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .report-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .report-date {
            color: #666;
            font-size: 14px;
        }

        .report-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .stat-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .action-buttons {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .summary-grid-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .summary-card h4 {
            font-size: 16px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .summary-card .number {
            font-size: 36px;
            font-weight: bold;
        }

        .student-entry {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .student-entry-info {
            flex: 1;
        }

        .student-entry-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .student-entry-details {
            font-size: 13px;
            color: #666;
        }

        .btn-remove {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }

        .btn-remove:hover {
            background: #c82333;
        }

        @media (max-width: 768px) {
            .attendance-container {
                flex-direction: column;
                height: auto;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e3e6f0;
            }

            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .report-stats {
                grid-template-columns: 1fr;
            }

            .main-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<div class="main-container">
    <div class="main-header">
        <h1>ğŸ« MIKIDS á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áŸá·áŸáŸ’áŸ</h1>
        <p>á”áŸ’ášá–áŸá“áŸ’á’á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áœááŸ’áá˜á¶á“ á“á·á„ášá”á¶á™á€á¶ášááŸáŸáŸ’áá·áá·áŸá·áŸáŸ’áŸ</p>
    </div>

    <div class="main-tabs">
        <button class="main-tab active" onclick="switchMainTab('attendance')">ğŸ“‹ áœááŸ’áá˜á¶á“áŸá·áŸáŸ’áŸ</button>
        <button class="main-tab" onclick="switchMainTab('statistics')">ğŸ“Š ášá”á¶á™á€á¶ášááŸáŸáŸ’áá·áá·</button>
    </div>

    <!-- ========== ATTENDANCE SYSTEM ========== -->
    <div id="attendance-system" class="main-tab-content active">
        <div class="attendance-container">
            <div class="sidebar">
                <p class="section-title">á‡áŸ’ášá¾áŸášá¾áŸá€á¶á›á”ášá·á…áŸ’á†áŸá‘</p>
                <input type="date" id="attDate" class="date-input">
                
                <p class="section-title">á”á‰áŸ’á‡á¸ááŸ’á“á¶á€áŸ‹</p>
                <div id="classList" class="class-list"></div>
            </div>

            <div class="content-area">
                <h3 id="displayClass" class="class-title">á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹</h3>
                
                <div class="summary-grid">
                    <div class="summary-box">
                        <div class="label">á˜á€ (âœ”ï¸)</div>
                        <div class="count" id="cP" style="color: #1cc88a;">0</div>
                    </div>
                    <div class="summary-box">
                        <div class="label">á…áŸ’á”á¶á”áŸ‹ (P)</div>
                        <div class="count" id="cL" style="color: #f6c23e;">0</div>
                    </div>
                    <div class="summary-box">
                        <div class="label">á¢áœááŸ’áá˜á¶á“ (A)</div>
                        <div class="count" id="cA" style="color: #e74a3b;">0</div>
                    </div>
                    <div class="summary-box">
                        <div class="label">áŸášá»á”</div>
                        <div class="count" id="cT">0</div>
                    </div>
                </div>

                <button class="btn-main" onclick="syncAttendanceToReport()" style="background: #4e73df; margin-bottom: 15px; width: 100%;">
                    ğŸ“Š á•áŸ’á‘áŸášá‘á·á“áŸ’á“á“áŸá™á‘áŸ…ášá”á¶á™á€á¶ášááŸáŸáŸ’áá·áá·
                </button>

                <div class="list-header">á”á‰áŸ’á‡á¸áŸá·áŸáŸ’áŸ</div>
                <div id="studentContainer"></div>

                <div class="bottom-actions">
                    <button class="btn-main btn-telegram" onclick="sendAttendanceToTelegram()">ğŸ“¤ á•áŸ’á‰á¾á‘áŸ… Telegram</button>
                    <button class="btn-main btn-excel" onclick="exportToExcel()">ğŸ“¥ ášá€áŸ’áŸá¶á‘á»á€á‡á¶ Excel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== STATISTICS SYSTEM ========== -->
    <div id="statistics-system" class="main-tab-content">
        <div class="stats-container">
            <div class="tabs">
                <button class="tab active" onclick="switchStatsTab('create')">á”á„áŸ’á€á¾áášá”á¶á™á€á¶ášááŸááŸ’á˜á¸</button>
                <button class="tab" onclick="switchStatsTab('view')">á˜á¾á›ášá”á¶á™á€á¶ášááŸ</button>
                <button class="tab" onclick="switchStatsTab('summary')">áŸá„áŸ’ááŸá”</button>
            </div>

            <!-- Create Report Tab -->
            <div id="create-tab" class="tab-content active">
                <form id="reportForm">
                    <div class="form-section">
                        <h3>á–áŸááŸŒá˜á¶á“ášá”á¶á™á€á¶ášááŸ</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ááŸ’á„áŸƒááŸ‚á†áŸ’á“á¶áŸ† *</label>
                                <input type="date" id="reportDate" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>áŸáŸ’áá·áá·áŸá·áŸáŸ’áŸáŸášá»á”</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸášá»á”á‘á¶áŸ†á„á–áŸ’ášá¹á€á“á·á„ášáŸáŸ€á› (á“á¶á€áŸ‹) *</label>
                                <input type="number" id="totalStudents" min="0" required readonly>
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸáŸ’ášá¸áŸášá»á” (á“á¶á€áŸ‹) *</label>
                                <input type="number" id="totalFemaleStudents" min="0" required readonly>
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸášáŸ€á“á–áŸá‰á˜áŸ‰áŸ„á„ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="fullTimeStudents" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸáŸ’ášá¸ášáŸ€á“á–áŸá‰á˜áŸ‰áŸ„á„ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="fullTimeFemale" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸááŸ‚á€á˜áŸ’á˜áœá·á’á¸á—á¶áŸá¶ááŸ’á˜áŸ‚ášáŸášá»á” (á“á¶á€áŸ‹)</label>
                                <input type="number" id="khmerOnlyTotal" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸáŸ’ášá¸ááŸ‚á€á˜áŸ’á˜áœá·á’á¸á—á¶áŸá¶ááŸ’á˜áŸ‚áš (á“á¶á€áŸ‹)</label>
                                <input type="number" id="khmerOnlyFemale" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸááŸ‚á€á˜áŸ’á˜áœá·á’á¸á—á¶áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸáŸášá»á” (á“á¶á€áŸ‹)</label>
                                <input type="number" id="englishOnlyTotal" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸáŸ’ášá¸ááŸ‚á€á˜áŸ’á˜áœá·á’á¸á—á¶áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="englishOnlyFemale" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>áŸá·áŸáŸ’áŸáŸá¶á€á›áŸ’á”á„</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸá¶á€á›áŸ’á”á„áŸášá»á” (á“á¶á€áŸ‹) *</label>
                                <input type="number" id="trialStudentsTotal" min="0" value="0" onchange="generateTrialStudentFields()">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸáŸ’ášá¸áŸá¶á€á›áŸ’á”á„ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="trialFemale" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>ááŸ’á„áŸƒááŸ‚á†áŸ’á“á¶áŸ†áŸá¶á€á›áŸ’á”á„</label>
                                <input type="date" id="trialDate">
                            </div>
                            <div class="form-group">
                                <label>ášá™áŸˆá–áŸá›áŸá¶á€á›áŸ’á”á„</label>
                                <input type="text" id="trialDuration" placeholder="á§. áŸ¡áŸá”áŸ’áá¶á áŸ, áŸ£ááŸ’á„áŸƒ">
                            </div>
                        </div>
                        <div id="trialStudentsContainer" style="margin-top: 20px;"></div>
                    </div>

                    <div class="form-section">
                        <h3>áŸá·áŸáŸ’áŸá‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚áš</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸá‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚ášáŸášá»á” (á“á¶á€áŸ‹)</label>
                                <input type="number" id="careServiceTotal" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸáŸ’ášá¸á‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚áš (á“á¶á€áŸ‹)</label>
                                <input type="number" id="careServiceFemale" min="0" value="0">
                            </div>
                        </div>
                        
                        <h4 style="color: #667eea; margin: 20px 0 10px 0;">áŸá·áŸáŸ’áŸá‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚ášááŸ’á˜á¸</h4>
                        <div id="newCareStudentsList"></div>
                        <div class="form-grid" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹</label>
                                <select id="newCareStudentClass" onchange="updateNewCareStudentList()">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ</label>
                                <select id="newCareStudentSelect">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>á€á¶á›á”ášá·á…áŸ’á†áŸá‘á…á¶á”áŸ‹á•áŸ’áá¾á˜</label>
                                <input type="date" id="newCareStartDate">
                            </div>
                        </div>
                        <button type="button" class="btn-main btn-primary" onclick="addNewCareStudent()" style="margin-top: 10px;">+ á”á“áŸ’ááŸ‚á˜áŸá·áŸáŸ’áŸá‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚ášááŸ’á˜á¸</button>

                        <h4 style="color: #e74a3b; margin: 20px 0 10px 0;">áŸá·áŸáŸ’áŸáˆá”áŸ‹á‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚áš</h4>
                        <div id="stopCareStudentsList"></div>
                        <div class="form-grid" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹</label>
                                <select id="stopCareStudentClass" onchange="updateStopCareStudentList()">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ</label>
                                <select id="stopCareStudentSelect">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>á€á¶á›á”ášá·á…áŸ’á†áŸá‘áˆá”áŸ‹</label>
                                <input type="date" id="stopCareDate">
                            </div>
                            <div class="form-group">
                                <label>á˜á¼á›á áŸáá»áˆá”áŸ‹</label>
                                <input type="text" id="stopCareReason" placeholder="á”á‰áŸ’á…á¼á›á˜á¼á›á áŸáá»">
                            </div>
                        </div>
                        <button type="button" class="btn-main btn-danger" onclick="addStopCareStudent()" style="margin-top: 10px;">+ á”á“áŸ’ááŸ‚á˜áŸá·áŸáŸ’áŸáˆá”áŸ‹á‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚áš</button>
                    </div>

                    <div class="form-section">
                        <h3>á–áŸá›á–áŸ’ášá¹á€</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸášá»á” (á“á¶á€áŸ‹)</label>
                                <input type="number" id="morningTotal" min="0" value="0" readonly>
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸáŸ’ášá¸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="morningFemale" min="0" value="0" readonly>
                            </div>
                            <div class="form-group">
                                <label>á¢áœááŸ’áá˜á¶á“áŸášá»á” (á“á¶á€áŸ‹)</label>
                                <input type="number" id="morningAbsentTotal" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>á¢áœááŸ’áá˜á¶á“áŸáŸ’ášá¸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="morningAbsentFemale" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>á¢á¶áá¶á–áŸ’á™á¶á”á¶á›á“á¶á€áŸ‹áŸá»áŸ† (á“á¶á€áŸ‹)</label>
                                <input type="number" id="morningParentPermission" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>á¢á¶áá¶á–áŸ’á™á¶á”á¶á›áŸáŸ’ášá¸á“á¶á€áŸ‹áŸá»áŸ† (á“á¶á€áŸ‹)</label>
                                <input type="number" id="morningParentPermissionFemale" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá¶á›á¶á‘á¶á€áŸ‹á‘á„á‘áŸ…áŸá½áš (á“á¶á€áŸ‹)</label>
                                <input type="number" id="morningSchoolContact" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá¶á›á¶á‘á¶á€áŸ‹á‘á„áŸáŸ’ášá¸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="morningSchoolContactFemale" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>á–áŸá›ášáŸáŸ€á›</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸášá»á” (á“á¶á€áŸ‹)</label>
                                <input type="number" id="afternoonTotal" min="0" value="0" readonly>
                            </div>
                            <div class="form-group">
                                <label>áŸá·áŸáŸ’áŸáŸáŸ’ášá¸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="afternoonFemale" min="0" value="0" readonly>
                            </div>
                            <div class="form-group">
                                <label>á¢áœááŸ’áá˜á¶á“áŸášá»á” (á“á¶á€áŸ‹)</label>
                                <input type="number" id="afternoonAbsentTotal" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>á¢áœááŸ’áá˜á¶á“áŸáŸ’ášá¸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="afternoonAbsentFemale" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>á¢á¶áá¶á–áŸ’á™á¶á”á¶á›á“á¶á€áŸ‹áŸá»áŸ† (á“á¶á€áŸ‹)</label>
                                <input type="number" id="afternoonParentPermission" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>á¢á¶áá¶á–áŸ’á™á¶á”á¶á›áŸáŸ’ášá¸á“á¶á€áŸ‹áŸá»áŸ† (á“á¶á€áŸ‹)</label>
                                <input type="number" id="afternoonParentPermissionFemale" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá¶á›á¶á‘á¶á€áŸ‹á‘á„á‘áŸ…áŸá½áš (á“á¶á€áŸ‹)</label>
                                <input type="number" id="afternoonSchoolContact" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>áŸá¶á›á¶á‘á¶á€áŸ‹á‘á„áŸáŸ’ášá¸ (á“á¶á€áŸ‹)</label>
                                <input type="number" id="afternoonSchoolContactFemale" min="0" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸</h3>
                        <div id="newStudentsList"></div>
                        <div class="form-grid" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹</label>
                                <select id="newStudentClass">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ</label>
                                <input type="text" id="newStudentName" placeholder="á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡">
                            </div>
                            <div class="form-group">
                                <label>á—áŸá‘</label>
                                <select id="newStudentGender">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸ --</option>
                                    <option value="M">á”áŸ’ášá»áŸ</option>
                                    <option value="F">áŸáŸ’ášá¸</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>á€á¶á›á”ášá·á…áŸ’á†áŸá‘á…á¼á›</label>
                                <input type="date" id="newStudentDate">
                            </div>
                            <div class="form-group">
                                <label>ášá™áŸˆá–áŸá›á”á„áŸ‹ááŸ’á›áŸƒáŸá·á€áŸ’áŸá¶</label>
                                <select id="newStudentPaymentDuration">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸ --</option>
                                    <option value="1month">áŸ¡ááŸ‚</option>
                                    <option value="3months">áŸ£ááŸ‚</option>
                                    <option value="6months">áŸ¦ááŸ‚</option>
                                    <option value="1year">áŸ¡á†áŸ’á“á¶áŸ†</option>
                                    <option value="custom">á•áŸ’áŸáŸá„áŸ—</option>
                                </select>
                            </div>
                            <div class="form-group" id="customPaymentField" style="display: none;">
                                <label>á”á‰áŸ’á‡á¶á€áŸ‹ášá™áŸˆá–áŸá›</label>
                                <input type="text" id="customPaymentDuration" placeholder="á§. áŸ¢ááŸ‚, áŸ©ááŸ‚">
                            </div>
                        </div>
                        <button type="button" class="btn-main btn-primary" onclick="addNewStudent()" style="margin-top: 10px;">+ á”á“áŸ’ááŸ‚á˜áŸá·áŸáŸ’áŸááŸ’á˜á¸</button>
                    </div>

                    <div class="form-section">
                        <h3>áŸá·áŸáŸ’áŸáˆá”áŸ‹</h3>
                        <div id="leftStudentsList"></div>
                        <div class="form-grid" style="margin-top: 15px;">
                            <div class="form-group">
                                <label>á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹</label>
                                <select id="leftStudentClass" onchange="updateLeftStudentList()">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ</label>
                                <select id="leftStudentSelect">
                                    <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ --</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>á€á¶á›á”ášá·á…áŸ’á†áŸá‘áˆá”áŸ‹</label>
                                <input type="date" id="leftStudentDate">
                            </div>
                            <div class="form-group">
                                <label>á˜á¼á›á áŸáá»áˆá”áŸ‹</label>
                                <input type="text" id="leftReason" placeholder="á”á‰áŸ’á…á¼á›á˜á¼á›á áŸáá»">
                            </div>
                        </div>
                        <button type="button" class="btn-main btn-danger" onclick="addLeftStudent()" style="margin-top: 10px;">+ á”á“áŸ’ááŸ‚á˜áŸá·áŸáŸ’áŸáˆá”áŸ‹</button>
                    </div>

                    <div>
                        <button type="submit" class="btn-main btn-primary">ášá€áŸ’áŸá¶á‘á»á€ášá”á¶á™á€á¶ášááŸ</button>
                        <button type="button" class="btn-main btn-secondary" onclick="resetReportForm()">á€áŸ†áááŸ‹á¡á¾á„áœá·á‰</button>
                    </div>
                </form>
            </div>

            <!-- View Reports Tab -->
            <div id="view-tab" class="tab-content">
                <div id="reportsList"></div>
            </div>

            <!-- Summary Tab -->
            <div id="summary-tab" class="tab-content">
                <div id="summaryContent"></div>
            </div>
        </div>
    </div>
</div>

<script>
// ========== ATTENDANCE SYSTEM DATA ==========
const studentData = {
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(á–áŸ’ášá¹á€)': [
        { id: '64', name: 'áƒá»á“ á‘áŸá–á„áŸ’áŸ', sex: 'M' }, { id: '121', name: 'á“á¿á“ áœáŒáŸ’áá“á¶', sex: 'M' },
        { id: '128', name: 'á–á·áŸá·á‘áŸ’á¢ á…áŸá“áŸ’á‘áœáŒáŸ’áƒ', sex: 'M' }, { id: '141', name: 'á áŸá„ áŸá¶á‡á¸á„', sex: 'F' },
        { id: '132', name: 'áŸá» á”á‰áŸ’á‰á¶ á˜á»á“á·ášá¶á‡', sex: 'M' }, { id: '67', name: 'áˆá¿á“ á”áŸŠá»á“á’á¿á“á–á»á‘áŸ’á’á·', sex: 'M' },
        { id: '173', name: 'áŸá¶á“áŸ’á á›á¸á”áŸ‰áŸá„', sex: 'M' }, { id: '163', name: 'á¢áŸá„ á›á¸á†áŸá„', sex: 'M' },
        { id: '179', name: 'á…á“áŸ’áá¶ áœáŒáŸ’áá“á¶', sex: 'M' }, { id: '162', name: 'á™áŸ‰á¶á“áŸ‹ áŸá»áá¡áŸá„', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(ášáŸáŸ€á›)': [
        { id: '139', name: 'á áŸŠáºá˜ á˜áŸ‰á¸á¢áŸŠá·', sex: 'M' }, { id: '146', name: 'á›á“ áœáŸáŸáŸ’áŸá—á¼', sex: 'M' },
        { id: '102', name: 'áŸáŸ†áá¶á„ áœá¸ášáŸˆá”á»ááŸ’áš', sex: 'M' }, { id: '67', name: 'áˆá¿á“ á”áŸŠá»á“á’á¿á“á–á»á‘áŸ’á’á·', sex: 'M' },
        { id: '87', name: 'á¢áŸŠá»áŸ† ášáá“á¶áŸá·á‘áŸ’á’á¸á€á¶áš', sex: 'F' },{ id: '113', name: 'áŸáŸŠá¸á˜ áŸá·á‘áŸ’á’á¸á€á¶áš', sex: 'F' },
        { id: '164', name: 'á¢áŸŠá¼áŸá»áœááŸ’á áœáŸá á¶áŸ', sex: 'M' }, { id: '177', name: 'áá¶áŸ†á„ á áŸŠá½á™á›á¸á“', sex: 'F' }, 
        { id: '165', name: 'á›á¹á˜ á›á¸á˜áŸ‰áŸá„á‚áŸá„áŸ’á‚', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(á–áŸ’ášá¹á€)': [
        { id: '29', name: 'áá¶á“áŸ‹ á˜á»á“á¸áœá›áŸ’á›á—á¶', sex: 'F' }, { id: '101', name: 'áˆá»áŸ† áœá¸ášáŸ‹áŸá·á‘áŸ’á’', sex: 'M' },
        { id: '65', name: 'á“á·á áŸá»á’á¶ášáŸ‰á¶', sex: 'M' }, { id: '78', name: 'á“á¸ á›á¸á‡á¸á„', sex: 'F' },
        { id: '117', name: 'á áŸŠá»á“ ášá¶ááŸ’áá‡áŸááŸáŸ’áŠá¶', sex: 'M' }, { id: '47', name: 'á”á»ááŸ’áá‡áŸ á‡áŸá“á“á¸', sex: 'F' },
        { id: '14', name: 'áƒá»á“ á‘áŸá–á¸', sex: 'F' }, { id: '62', name: 'ášá·á‘áŸ’á’á¸ á–á·áŸáŸ’áŸá»ááŸá»á€áŸ’ášá¹á', sex: 'M' },
        { id: '49', name: 'á„á·á“ á‘áŸ€á“áœá·á“', sex: 'M' }, { id: '107', name: 'áŸá»á—á€áŸ’ášáŸ áœášáŸˆáŸá·á‘áŸ’á’', sex: 'M' },
        { id: '170', name: 'á¢á»á›áœá¿á“ áŠá¶áœá¸á“', sex: 'F' }, { id: '137', name: 'áŸá¿á“ á…á¶á“áŸ‹áŸá»á˜áŸá’á¶', sex: 'F' },
        { id: '1', name: 'á”áŸŠá»á“ášá¸á“ ááŸá˜ášá¶', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(ášáŸáŸ€á›)': [
        { id: '54', name: 'á™á“áŸ‹ á›á¸á áŸá„', sex: 'M' }, { id: '75', name: 'áœá·á“ á”á‰áŸ’á‰á¶áœáŸá“áŸ’á', sex: 'M' },
        { id: '90', name: 'áŸá¼ ášáŸáŸ’á˜á¸á–á“á·áá¶', sex: 'F' }, { id: '50', name: 'áŸá¼á™ ášá€áŸ’áŸá¶', sex: 'M' },
        { id: '72', name: 'á¢áŸŠá¼ áŸá»áá¢á¶á˜á¸', sex: 'F' }, { id: '137', name: 'áŸá¿á“ á…á¶á“áŸ‹áŸá»á˜áŸá’á¶', sex: 'F' },
        { id: '176', name: 'á”áŸ‰á¹á˜ á˜áŸ‰á¸á‡á¼', sex: 'F' }, { id: '85', name: 'áŸáŸášá¸ á…á“áŸ’á‘áœáŒáŸ’áá“á¶', sex: 'M' },
        { id: '161', name: 'á›á¸á˜ á áŸŠá¸á”áŸ‰', sex: 'M' }, { id: '55', name: 'á¢áŸŠá¶ á‡á¸á„á áŸáš', sex: 'F' },
        { id: '79', name: 'á˜á·ááŸ’á á˜áŸ‰áŸá„á áŸá„', sex: 'M' }, { id: '74', name: 'á…á¶á“áŸ‹á“á¸â€‹ áŸáŸŠá¼áŸá¶á“áŸ‹áá¶', sex: 'F' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(á–áŸ’ášá¹á€)': [
        { id: '75', name: 'á†á“ áœá·ášáŸˆáŸá·á‘áŸ’á’', sex: 'M' }, { id: '47', name: 'á‡á¶á¡á·á… á€á¼á›á¸á“', sex: 'M' },
        { id: '92', name: 'áŸá»á”á‰áŸ’á‰á¶ áŸáŸ„á˜áŸ‰á¶', sex: 'F' }, { id: '83', name: 'á—áºá“ áá·ášá¶á™á»', sex: 'M' },
        { id: '69', name: 'á›á¸ á†á¶á™áˆáŸá“', sex: 'M' }, { id: '77', name: 'áœá»áŒáŸ’áá¸ áŠá¶áœá¸á€á¶', sex: 'F' },
        { id: '93', name: 'á¢áŸŠá¹á˜ ášáŸ„á…á“á¶', sex: 'F' }, { id: '72', name: 'áœá„áŸ’áŸ áŠá¶ášáŸ‰á¶áœá¸á“', sex: 'M' },
        { id: '95', name: 'á…á¶áœ áœá·á“á á¶áœ', sex: 'M' }, { id: '80', name: 'á„á½á“ á”á‰áŸ’á‰á¶á–á»á‘áŸ’á’á·áŸáŸá€áŸ’áá·', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(ášáŸáŸ€á›)': [
        { id: '88', name: 'á…áŸ†ášá¾á“ á…á“áŸ’á‘á§ááŸ’áá˜', sex: 'M' }, { id: '91', name: 'á”áŸŠá¼ áŸá¶á’á»á€á¶áš', sex: 'F' },
        { id: '82', name: 'áŸáŸá“ á™áŸ‰á¶áŸáŸ’á˜á¸á“áá¶', sex: 'F' }, { id: '85', name: 'áŠá“ áŸá»á—áŸááŸ’áŒá˜áŸ‰á¼á“á¸á€á¶', sex: 'F' },
        { id: '78', name: 'áŸáŸŠáŸ’ášá¶á„ áŸáŸ€áœá áŸ’áœá»á„', sex: 'F' }, { id: '73', name: 'á áŸá„ á˜áŸ‰á¸á¢áŸŠá·', sex: 'F' },
        { id: '74', name: 'á¢á¿á“ á–áŸ…áœá›áŸá€áŸ’á', sex: 'F' }, { id: '70', name: 'ášáŸááŸ’á“ ášáŸ‰á¶ááŸá”', sex: 'M' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(á–áŸ’ášá¹á€)': [
        { id: '21', name: 'á…á“áŸ’áá¶ á›á¸áá¶', sex: 'F' }, { id: '20', name: 'á–áŸ… áŸá»áá…á·á“', sex: 'M' },
        { id: '17', name: 'áá¶ášáŸ‰á¶ á áŸá„á›á¸', sex: 'M' }, { id: '23', name: 'áŸá»á áŸá˜áŸ’á”ááŸ’áá·', sex: 'M' },
        { id: '22', name: 'áŸá»á áŠá¶á›á¸áŸ', sex: 'F' }, { id: '29', name: 'áŸáŸ’ášáŸáŸ‹ ášá¸á áŸ’áŸá¶', sex: 'F' },
        { id: '41', name: 'á”áŸ‰á»á“ ášá¸á™áŸ‰á¶', sex: 'F' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(ášáŸáŸ€á›)': [
        { id: '59', name: 'á¢á»á„ á”á‰áŸ’á‰á¶ášáŸááŸ’á“', sex: 'M' }, { id: '31', name: 'á˜á·ááŸ’á á˜áŸ‰áŸá„á á½áš', sex: 'M' },
        { id: '14', name: 'á™áŸáŸ‹ á“ášá·á“áŸ’á‘', sex: 'M' }, { id: '33', name: 'áœá„áŸ‹ á–á»á‘áŸ’á’á·áá¶', sex: 'F' },
        { id: '62', name: 'áŸá¼á™ á”á‰áŸ’á‰á¶', sex: 'M' }, { id: '40', name: 'áŸáŸá„ áŸá¶áá¶', sex: 'F' },
        { id: '39', name: 'á…á“áŸ’á‘ áŸá»á•á¶á™áŸ‰á¶á˜áŸáƒ', sex: 'M' }, { id: '30', name: 'áŸáŸŠá“áœá¸ášáŸˆ á”á‰áŸ’á‰á¶á‘áŸá–á¸', sex: 'F' },
        { id: '27', name: 'á”áŸŠá¼ áá¶á˜áŸ‰á¶', sex: 'M' }, { id: '65', name: 'á€áŸ‚áœ á˜á»á“áŸ’á“á¸á§ááŸ’áá˜', sex: 'M' },
        { id: '56', name: 'áœá“áŸ’ááœá·á“ áá¶áá¶', sex: 'F' }, { id: '36', name: 'á á¶á“ áŸáŸŠá¸áœá áŸáš', sex: 'F' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ£(ášáŸáŸ€á›)': [
        { id: '9', name: 'á€áŸ‚áœ áœá¸á“áŸá»á§ááŸ’ááá¶ášá¶', sex: 'F' }, { id: '28', name: 'áˆá»á“áá¶ ášáá“áŸˆáá»á“áŠá¼', sex: 'F' },
        { id: '10', name: 'á™áŸ‰á¶ á–áŸá‡áŸ’ášá˜áŸ‰á¼á“á¸á€á¶', sex: 'F' }, { id: '15', name: 'á›á¸á˜ á–á»á‘áŸ’á’á·ášá¶á‡', sex: 'M' },
        { id: '3', name: 'á¡ áŸáŸŠá¸áœá áŸŠá½á™', sex: 'F' }, { id: '2', name: 'á¡á¶á™ á˜á»á“á·á…á·á“áŸ’áŠá¶', sex: 'F' },
        { id: '24', name: 'á¢áŸ„á€ á“á·áŸá·áŸ’áŸá', sex: 'M' }, { id: '44', name: 'á…áŸ†ášá¾á“ á˜áŸ‰á¶á“á¸áá¶', sex: 'F' }
    ],
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¤ áŸ¥': [
        { id: '1', name: 'á¡á¶á™ á—á¶ášáŸ‰á¶áŠá¶áœá¸áŒ', sex: 'M' }, { id: '42', name: 'áœá„áŸ’áŸ á˜á»á“á¸á€á‰áŸ’á…á“á¶', sex: 'F' },
        { id: '43', name: 'á–áŸ… áŸá»á“á¸áá¶', sex: 'F' }, { id: '4', name: 'á¡ áŸá»áœááŸ’áá á¶á“áŸ‹áá¶', sex: 'F' }
    ],
    'Fount1 mooning': [
        { id: '82', name: 'ášá»á“ ášáŸáŸ’á˜á¸', sex: 'M' }, { id: '149', name: 'á’á¸ áŸá»áœááŸ’á áŸá·á‘áŸ’á’á·á€á¶', sex: 'F' },
        { id: '143', name: 'á•á“ áŸá»áá áŸ€á„', sex: 'M' }, { id: '133', name: 'áŸá»á‘áŸ’á’ á›á¸á“á”áŸ’ášá»áŸáŸá·á‘áŸ’á’', sex: 'M' },
        { id: '134', name: 'á¢áŸŠá¶á” á›á¸á™á¸á„', sex: 'F' }, { id: '88', name: 'á…áŸ†ášá¾á“ á…á“áŸ’á‘á§ááŸ’áá˜', sex: 'M' },
        { id: '127', name: 'á á˜ á…á¶á“áŸ‹á”á»ášá¸ášá€áŸ’áŸ', sex: 'M' }, { id: '182', name: 'áá¶áŸ†á„ á áŸŠá½á™á›á¸á“', sex: 'F' }
    ],
    'Fount1 Evening': [
        { id: '116', name: 'á†á“ á˜áŸ‰áŸá„áŸáŸŠá¸á“', sex: 'M' }, { id: '58', name: 'á„á½á“ á‚á¸á˜á á¶á”áŸ‹', sex: 'M' },
        { id: '145', name: 'á†á¶á™ á—á¸á„á¢áŸŠá¸á„', sex: 'F' }, { id: '125', name: 'á”á‰áŸ’á‰á¶ á—áŸááŸ’ášá¶', sex: 'F' },
        { id: '90', name: 'á…áŸ†ášá¾á“ ášá¿á“ášá¹á‘áŸ’á’á·ášá¶á‡', sex: 'M' }, { id: '159', name: 'áá“ áŸáŸŠá¸á áŸ’á‚áŸ’áŸá·á…', sex: 'F' }
    ],
    'Nursery(á–áŸ’ášá¹á€)': [
        { id: '148', name: 'á”áŸášáŸ‰áŸáŸ á˜áŸ‰áŸƒáƒá¾áŸ', sex: 'M' }, { id: '144', name: 'á áŸá„ áŸá“áŸ’áá·á—á¶á–', sex: 'M' },
        { id: '157', name: 'áŠá½á„ áŸá»á˜áŸá’á¶', sex: 'M' }, { id: '183', name: 'áá»á„ á áŸ’áœá»á„á˜áŸ‰áŸá„', sex: 'M' },
        { id: '158', name: 'á–á“áŸ’á›á€ áœá·ášáŸá·á‘áŸ’á’', sex: 'M' }, { id: '172', name: 'ášáá“á¶ áŸáŸ€áœá›á·', sex: 'F' },
        { id: '180', name: 'ášáŸ‰á¶ááŸ‹ á–áŸá‡áŸ’ášá˜ášá€á', sex: 'F' }, { id: '178', name: 'á›á¸áœá‘áŸ’á’á¸ á‡á»áá·á˜á¶', sex: 'F' },
        { id: '184', name: 'á á¼ á›á¸á—á¸á„', sex: 'M' }, { id: '174', name: 'áœá·á…áŸ’á†á·á€á¶ á˜á»á“áŸ’á“á¸á‘áŸá–á¸', sex: 'F' },
        { id: '185', name: 'á™á¹á˜ á–á»á‘áŸ’á’á·áœá„áŸ’áŸ', sex: 'M' }, { id: '171', name: 'áŸá»á„ áŸá·ášá¸á”á»ááŸ’áš', sex: 'M' }
    ],
    'Nursery(ášáŸáŸ€á›)': [
        { id: '148', name: 'á”áŸášáŸ‰áŸáŸ á˜áŸ‰áŸƒáƒá¾áŸ', sex: 'M' }, { id: '147', name: 'áŸá»á—áŸá€áŸ’áš áœá¸ášá”á»ááŸ’áš', sex: 'M' },
        { id: '150', name: 'áœáŸ‰áŸá á“á¸ášá¸áá¶', sex: 'F' }, { id: '166', name: 'á›á¸áá¶ á á»á„áŸáŸá€áŸ’á€á·á¢á’á·á—á¼', sex: 'M' }
    ],
    'Fount2': [
        { id: '86', name: 'á’áŸá„ á˜áŸ‰áŸá„á›á¸', sex: 'M' }, { id: '00', name: 'áŸáŸŠáŸ’ášá¶á„ áŸáŸ€áœá áŸ’áœá»á„', sex: 'F' },
        { id: '00', name: 'á áŸá„ á˜áŸ‰á¸á¢áŸŠá·', sex: 'F' }, { id: '00', name: 'á¢á¿á“ á–áŸ…áœá›áŸá€áŸ’á', sex: 'F' },
        { id: '00', name: 'á á¶á“ áŸáŸŠá¸áœá áŸáš', sex: 'F' }, { id: '00', name: 'ášáŸááŸ’á“ áŸá»áœááŸ’áá…áŸá“áŸ’á‘áá¶á€á¶', sex: 'M' },
        { id: '00', name: 'á…áŸ†ášá¾á“ á˜áŸ‰á¶á“á¸áá¶ ', sex: 'F' }, { id: '70', name: 'ášáŸááŸ’á“ ášáŸ‰á¶ááŸá”', sex: 'M' }
    ],
    'Fount2(narein)': [
        { id: '68', name: 'áŸá»á„ ášá¹á‘áŸ’á’áŸáŸá€áŸ’á€', sex: 'M' }, { id: '00', name: 'á–áŸ… áŸá»áá…á·á“', sex: 'M' },
        { id: '66', name: 'á”áŸŠá»á“á¡áŸá„ á¢áŸŠáŸƒáŠá¹á€', sex: 'M' }, { id: '67', name: 'á—áŸ„á‚ áŸáŸ’á–á¸ááŒá¸', sex: 'M' },
        { id: '00', name: 'á¢áŸŠá¹á˜ ášáŸ„á…á“á¶', sex: 'F' }, { id: '00', name: 'á„á½á“ á”á‰áŸ’á‰á¶á–á»á‘áŸ’á’á·áŸáŸá€áŸ’áá·', sex: 'M' },
        { id: '00', name: 'á‡á¶á¡á·á… á€á¼á›á¸á“', sex: 'M' }, { id: '00', name: 'áá¶ášáŸ‰á¶ á áŸá„á›á¸', sex: 'M' },
        { id: '00', name: 'á†á“ áœá·ášáŸˆáŸá·á‘áŸ’á’', sex: 'M' }, { id: '00', name: 'áŸá»á áŸá˜áŸ’á”ááŸ’áá·', sex: 'M' },
        { id: '00', name: 'áŸá»á áŠá¶á›á¸áŸ', sex: 'F' }, { id: '00', name: 'á…á¶áœ áœá·á“á á¶áœ', sex: 'M' },
        { id: '00', name: 'á›á¸ á†á¶á™áˆáŸá“á”', sex: 'M' }
    ],
    'Level1': [
        { id: '00', name: 'á¢áŸ„á€ á§ááŸ’áá˜', sex: 'M' }, { id: '00', name: 'áá¶ášáŸ‰á¶ á áŸá„á¡á¶á™', sex: 'M' },
        { id: '62', name: 'áˆá¼á€ áˆá·á“á¡á»á„', sex: 'M' }, { id: '00', name: 'á–áŸ… áŸá»á“á¸áá¶', sex: 'F' },
        { id: '00', name: 'á€áŸ‚áœ áœá¸á“áŸá»á§ááŸ’ááá¶ášá¶', sex: 'F' }, { id: '00', name: 'áˆá»á“áá¶ ášáá“áŸˆáá»á“áŠá¼', sex: 'F' },
        { id: '64', name: 'á›á¶á„ áœáŒáŸ’áƒá“á’á“á»', sex: 'M' }, { id: '00', name: 'á™áŸ‰á¶ á–áŸá‡áŸ’ášá˜áŸ‰á¼á“á¸á€á¶', sex: 'F' },
        { id: '00', name: 'á›á¸á˜ á–á»á‘áŸ’á’á·ášá¶á‡', sex: 'M' }, { id: '00', name: 'á¡ áŸáŸŠá¸áœá áŸŠá½á™', sex: 'F' },
        { id: '00', name: 'á¡á¶á™ á˜á»á“á·á…á·á“áŸ’áŠá¶', sex: 'F' }, { id: '00', name: 'á¢áŸ„á€ á“á·áŸá·áŸ’áŸá', sex: 'M' },
        { id: '00', name: 'á…á“áŸ’á‘ áŸá»á•á¶á™áŸ‰á¶á˜áŸáƒ', sex: 'M' }, { id: '00', name: 'áŸáŸŠá“áœá¸ášáŸˆ á”á‰áŸ’á‰á¶á‘áŸá–á¸', sex: 'F' }
    ],
    'Level2': [
        { id: '48', name: 'áŸá»á—á€áŸ’áŠá· á‘á·ááŸ’ášáŠá¶áá¶', sex: 'F' }, { id: '63', name: 'á“á¿á“ áœáŒáŸ’áá“áŸ‡', sex: 'M' },
        { id: '49', name: 'áŸá»á—á€áŸ’áŠá· ášáá“', sex: 'M' }, { id: '61', name: 'á•á›â€‹ áŸá»áœááŸ’á', sex: 'M' },
        { id: '53', name: 'á á»á„ áŸá·á‘áŸ’á’á·áá¶á›áŸ‹', sex: 'M' }, { id: '55', name: 'á’áŸá„ á‡á¼á›á¸á‰', sex: 'F' },
        { id: '1', name: 'á¡á¶á™ á—á¶ášáŸ‰á¶áŠá¶áœá¸áŒ', sex: 'M' }, { id: '4', name: 'á¡ áŸá»áœááŸ’áá á¶á“áŸ‹áá¶', sex: 'F' }
    ],
    'á˜ááŸ’áŠáŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(á–áŸ’ášá¹á€)': [
        { id: '147', name: 'áŸá»á—á€áŸ’áš áœá¸ášá”á»ááŸ’áš', sex: 'M' }, { id: '166', name: 'á›á¸áá¶ ášáŸááŸ’á“á á»á„áŸáŸá€áŸ’á€á·á¢á’á·á—á¼', sex: 'M' },
        { id: '160', name: 'áá¼ áŸá·á‘áŸ’á’á¸á™á¼áá¶', sex: 'F' }, { id: '175', name: 'áŸá»á‚á“áŸ’á’ á”á‰áŸ’á‰á¶áŸáŸá€', sex: 'M' },
        { id: '000', name: 'áŸá»á¸á˜ áŸášá§ááŸ’áá˜', sex: 'M' },{ id: '000' , name: 'á“á·á áŸá»á’á¶ášá¶á‡',  sex:'M'},
        { id: '000', name: 'áœáŸ‰áŸá á“á¸ášá¸áá¶', sex: 'F' }
    ],
    'á˜ááŸ’áŠáŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(ášáŸáŸ€á›)':[
        { id: '175', name: 'á áŸá„ á‡áŸášá˜á»á¸á„', sex: 'F' }, { id: '000', name: 'áŸá¶á™ áŸá»áá áŸá„', sex: 'M' },
        { id: '181', name: 'áˆá“ á…áŸáŸáŸ’áŠá¶', sex: 'M' }, { id: '000', name: 'á›á¶á„ á›á€áŸ’áŸá»á·á€á‰áŸ’á…á“á¶', sex: 'M' },
        { id: '177', name: 'áœá¶áŸá“á¶ á–áŸá‡áŸ’ášáŸá»á˜áŸ‰á¶á›á¸', sex: 'F' }
    ]
};

const classChatIds = {
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(á–áŸ’ášá¹á€)': '-4845440768',
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá˜á’áŸ’á™á˜(ášáŸáŸ€á›)': '-4845440768',
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(á–áŸ’ášá¹á€)': '-4828804361',
    'ááŸ’á“á¶á€áŸ‹á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áááŸ’á–áŸáŸ‹(ášáŸáŸ€á›)': '-4828804361',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(á–áŸ’ášá¹á€)': '-4936041559',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¡(ášáŸáŸ€á›)': '-4936041559',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(á–áŸ’ášá¹á€)': '-4953929888',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¢(ášáŸáŸ€á›)': '-4953929888',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ£(ášáŸáŸ€á›)': '-4872387682',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¤ ': '-4844052526',
    'ááŸ’á“á¶á€áŸ‹á‘á¸áŸ¥': '-4712921883',
    'Fount1 morning': '-4986675448',
    'Fount1 Evening': '-4986675448',
    'Nursery(á–áŸ’ášá¹á€)': '-4924159874',
    'Nursery(ášáŸáŸ€á›)': '-4924159874',
    'Fount2': '-4871212513',
    'Fount2(narein)': '-4871212513',
    'Level1': '-4906276801',
    'Level2': '-4968404918',
    'á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(á–áŸ’ášá¹á€)': '-4835279036',
    'á˜ááŸ’ááŸá™áŸ’á™á€á˜áŸ’ášá·áá‘á¶á”(ášáŸáŸ€á›)': '-4835279036'
};

const TELEGRAM_BOT_TOKEN = '8501623225:AAGu-F_GHSQ-dLBrEME7eidOpW2yDf3qvXw';

let selectedClassName = '';
let reports = [];
let newStudentsArray = [];
let leftStudentsArray = [];
let trialStudentsArray = [];
let newCareStudentsArray = [];
let stopCareStudentsArray = [];

// Load data from localStorage
function loadStudentData() {
    const saved = localStorage.getItem('studentDataMIKIDS');
    if (saved) {
        try {
            const parsed = JSON.parse(saved);
            Object.keys(parsed).forEach(className => {
                studentData[className] = parsed[className];
            });
        } catch (e) {
            console.error('Error loading student data:', e);
        }
    }
}

function saveStudentData() {
    try {
        localStorage.setItem('studentDataMIKIDS', JSON.stringify(studentData));
    } catch (e) {
        console.error('Error saving student data:', e);
    }
}

function loadReports() {
    const saved = localStorage.getItem('studentReports');
    if (saved) {
        reports = JSON.parse(saved);
    }
}

function saveReports() {
    localStorage.setItem('studentReports', JSON.stringify(reports));
}

// ========== MAIN TAB SWITCHING ==========
function switchMainTab(tabName) {
    document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.main-tab-content').forEach(t => t.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName + '-system').classList.add('active');
}

// Show/hide custom payment duration field
document.addEventListener('DOMContentLoaded', function() {
    const paymentSelect = document.getElementById('newStudentPaymentDuration');
    if (paymentSelect) {
        paymentSelect.addEventListener('change', function() {
            const customField = document.getElementById('customPaymentField');
            if (this.value === 'custom') {
                customField.style.display = 'block';
            } else {
                customField.style.display = 'none';
                document.getElementById('customPaymentDuration').value = '';
            }
        });
    }
});

// ========== ATTENDANCE SYSTEM FUNCTIONS ==========
document.getElementById('attDate').valueAsDate = new Date();
const classListDiv = document.getElementById('classList');

Object.keys(studentData).forEach((className, index) => {
    const div = document.createElement('div');
    div.className = `class-item ${index === 0 ? 'active' : ''}`;
    div.innerText = className;
    div.onclick = () => selectClass(div, className);
    classListDiv.appendChild(div);
});

function selectClass(element, className) {
    document.querySelectorAll('.class-item').forEach(i => i.classList.remove('active'));
    element.classList.add('active');
    selectedClassName = className;
    document.getElementById('displayClass').innerText = className;
    renderStudents(className);
}

function renderStudents(className) {
    const container = document.getElementById('studentContainer');
    container.innerHTML = "";
    const students = studentData[className] || [];
    
    students.forEach(s => {
        const card = document.createElement('div');
        card.className = 'student-card';
        card.setAttribute('data-name', s.name);
        card.setAttribute('data-id', s.id);
        card.setAttribute('data-sex', s.sex);
        card.innerHTML = `
            <div class="student-id">${s.id}</div>
            <div class="student-info">
                <div class="student-name">${s.name}</div>
                <div class="student-sex">Sex: ${s.sex === 'M' ? 'Male' : 'Female'}</div>
            </div>
            <div class="attendance-btns">
                <button class="btn-att present" onclick="mark(this, 'âœ”ï¸')">âœ”ï¸</button>
                <button class="btn-att permission" onclick="mark(this, 'P')">P</button>
                <button class="btn-att absent" onclick="mark(this, 'A')">A</button>
            </div>
        `;
        container.appendChild(card);
    });
    calculateSummary();
}

function mark(btn, type) {
    const parent = btn.parentElement;
    parent.querySelectorAll('.btn-att').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    calculateSummary();
}

function calculateSummary() {
    const permissionCount = document.querySelectorAll('.btn-att.permission.active').length;
    const absentCount = document.querySelectorAll('.btn-att.absent.active').length;
    const totalStudents = document.querySelectorAll('.student-card').length;
    const presentCount = totalStudents - (permissionCount + absentCount);
    
    document.getElementById('cP').innerText = presentCount;
    document.getElementById('cL').innerText = permissionCount;
    document.getElementById('cA').innerText = absentCount;
    document.getElementById('cT').innerText = totalStudents;
}

async function sendAttendanceToTelegram() {
    if (!selectedClassName) return alert("âš ï¸ áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹!");
    
    const chatId = classChatIds[selectedClassName] ? classChatIds[selectedClassName].trim() : null;
    if (!chatId) return alert("âš ï¸ á˜á·á“á‘á¶á“áŸ‹á˜á¶á“ Chat ID áŸá˜áŸ’ášá¶á”áŸ‹ááŸ’á“á¶á€áŸ‹á“áŸáŸ‡!");

    const date = document.getElementById('attDate').value;
    const allCards = document.querySelectorAll('.student-card');
   
    const permissionCount = document.querySelectorAll('.btn-att.permission.active').length;
    const absentCount = document.querySelectorAll('.btn-att.absent.active').length;
    const totalAbsent = permissionCount + absentCount;
    
    let message = `<b>ğŸ“Š ášá”á¶á™á€á¶ášááŸáœááŸ’áá˜á¶á“</b>\n`;
    message += `ğŸ« ááŸ’á“á¶á€áŸ‹: <b>${selectedClassName}</b>\n`;
    message += `ğŸ“… ááŸ’á„áŸƒá‘á¸: ${date}\n`;
    message += `--------------------------\n`;
    
    let hasIssue = false;
    allCards.forEach((card) => {
        const isP = card.querySelector('.btn-att.permission').classList.contains('active');
        const isA = card.querySelector('.btn-att.absent').classList.contains('active');
        if (isP || isA) {
            hasIssue = true;
            const name = card.getAttribute('data-name');
            const id = card.getAttribute('data-id');
            message += `ğŸ†” ${id}. ${name} -> ${isP ? 'ğŸŸ¡ á…áŸ’á”á¶á”áŸ‹' : 'ğŸ”´ á¢áœááŸ’áá˜á¶á“'}\n`;
        }
    });

    if (!hasIssue) message += "âœ… áŸá·áŸáŸ’áŸáœááŸ’áá˜á¶á“á‚áŸ’ášá”áŸ‹á…áŸ†á“á½á“\n";
    
    message += `--------------------------\n`;
    message += `âŒ á¢áœááŸ’áá˜á¶á“áŸášá»á”: <b>${totalAbsent}</b> á“á¶á€áŸ‹\n`;
    message += `   ğŸŸ¡ á…áŸ’á”á¶á”áŸ‹: ${permissionCount} á“á¶á€áŸ‹\n`;
    message += `   ğŸ”´ á¥áá…áŸ’á”á¶á”áŸ‹: ${absentCount} á“á¶á€áŸ‹`;

    try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                chat_id: chatId, 
                text: message, 
                parse_mode: 'HTML'
            })
        });
        const result = await response.json();
        if (response.ok) {
            alert("âœ… á”á¶á“á•áŸ’á‰á¾á‘áŸ… Telegram ášá½á…ášá¶á›áŸ‹!");
        } else {
            alert(`âŒ á”ášá¶á‡áŸá™! ${result.description}`);
        }
    } catch (e) { 
        alert("âŒ á”á‰áŸ’á á¶á”á…áŸ’á…áŸá€á‘áŸáŸ! áŸá¼á˜á–á·á“á·ááŸ’á™á¢áŸŠá¸á“á’áºáá·ááŸ”");
    }
}

function exportToExcel() {
    alert('Feature coming soon!');
}

// ========== SYNC ATTENDANCE TO REPORT ==========
function syncAttendanceToReport() {
    // Calculate totals from all classes
    let morningTotal = 0;
    let morningFemale = 0;
    let morningAbsent = 0;
    let morningAbsentFemale = 0;
    let morningPermission = 0;
    let morningPermissionFemale = 0;
    
    let afternoonTotal = 0;
    let afternoonFemale = 0;
    let afternoonAbsent = 0;
    let afternoonAbsentFemale = 0;
    let afternoonPermission = 0;
    let afternoonPermissionFemale = 0;
    
    let grandTotal = 0;
    let grandTotalFemale = 0;
    
    // Loop through all classes and count
    Object.keys(studentData).forEach(className => {
        const students = studentData[className];
        const isMorning = className.includes('á–áŸ’ášá¹á€') || className.toLowerCase().includes('mooning');
        const isAfternoon = className.includes('ášáŸáŸ€á›') || className.toLowerCase().includes('evening');
        
        students.forEach(student => {
            const isFemale = student.sex === 'F';
            
            // Add to grand total
            grandTotal++;
            if (isFemale) grandTotalFemale++;
            
            // Add to morning/afternoon
            if (isMorning) {
                morningTotal++;
                if (isFemale) morningFemale++;
            }
            if (isAfternoon) {
                afternoonTotal++;
                if (isFemale) afternoonFemale++;
            }
        });
    });
    
    // Now count absences from current attendance check
    document.querySelectorAll('.student-card').forEach(card => {
        const isFemale = card.getAttribute('data-sex') === 'F';
        const className = document.getElementById('displayClass').innerText;
        const isMorning = className.includes('á–áŸ’ášá¹á€') || className.toLowerCase().includes('mooning');
        const isAfternoon = className.includes('ášáŸáŸ€á›') || className.toLowerCase().includes('evening');
        
        const isPermission = card.querySelector('.btn-att.permission').classList.contains('active');
        const isAbsent = card.querySelector('.btn-att.absent').classList.contains('active');
        
        if (isPermission) {
            if (isMorning) {
                morningPermission++;
                if (isFemale) morningPermissionFemale++;
            }
            if (isAfternoon) {
                afternoonPermission++;
                if (isFemale) afternoonPermissionFemale++;
            }
        }
        
        if (isAbsent) {
            if (isMorning) {
                morningAbsent++;
                if (isFemale) morningAbsentFemale++;
            }
            if (isAfternoon) {
                afternoonAbsent++;
                if (isFemale) afternoonAbsentFemale++;
            }
        }
    });
    
    // Switch to statistics tab
    document.querySelector('.main-tab:nth-child(2)').click();
    
    // Wait a bit for tab to switch
    setTimeout(() => {
        // Fill in the values
        document.getElementById('totalStudents').value = grandTotal;
        document.getElementById('totalFemaleStudents').value = grandTotalFemale;
        
        document.getElementById('morningTotal').value = morningTotal;
        document.getElementById('morningFemale').value = morningFemale;
        document.getElementById('morningAbsentTotal').value = morningAbsent;
        document.getElementById('morningAbsentFemale').value = morningAbsentFemale;
        document.getElementById('morningParentPermission').value = morningPermission;
        document.getElementById('morningParentPermissionFemale').value = morningPermissionFemale;
        
        document.getElementById('afternoonTotal').value = afternoonTotal;
        document.getElementById('afternoonFemale').value = afternoonFemale;
        document.getElementById('afternoonAbsentTotal').value = afternoonAbsent;
        document.getElementById('afternoonAbsentFemale').value = afternoonAbsentFemale;
        document.getElementById('afternoonParentPermission').value = afternoonPermission;
        document.getElementById('afternoonParentPermissionFemale').value = afternoonPermissionFemale;
        
        alert(`âœ… á•áŸ’á‘áŸášá‘á·á“áŸ’á“á“áŸá™ášá½á…ášá¶á›áŸ‹!\n\n` +
              `ğŸ‘¥ áŸá·áŸáŸ’áŸáŸášá»á”: ${grandTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${grandTotalFemale})\n` +
              `ğŸŒ… á–áŸá›á–áŸ’ášá¹á€: ${morningTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${morningFemale})\n` +
              `ğŸŒ† á–áŸá›ášáŸáŸ€á›: ${afternoonTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${afternoonFemale})`);
    }, 300);
}

// ========== STATISTICS REPORT FUNCTIONS ==========
function switchStatsTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(tabName + '-tab').classList.add('active');

    if (tabName === 'view') {
        displayReports();
    } else if (tabName === 'summary') {
        displaySummary();
    } else if (tabName === 'create') {
        populateClassDropdowns();
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('reportDate').value = today;
        calculateTotalsFromStudentData();
    }
}

function populateClassDropdowns() {
    const newClassSelect = document.getElementById('newStudentClass');
    const leftClassSelect = document.getElementById('leftStudentClass');
    const newCareClassSelect = document.getElementById('newCareStudentClass');
    const stopCareClassSelect = document.getElementById('stopCareStudentClass');
    
    // Clear existing options
    newClassSelect.innerHTML = '<option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>';
    leftClassSelect.innerHTML = '<option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>';
    newCareClassSelect.innerHTML = '<option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>';
    stopCareClassSelect.innerHTML = '<option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>';
    
    Object.keys(studentData).forEach(className => {
        const option1 = document.createElement('option');
        option1.value = className;
        option1.textContent = className;
        newClassSelect.appendChild(option1);
        
        const option2 = document.createElement('option');
        option2.value = className;
        option2.textContent = className;
        leftClassSelect.appendChild(option2);
        
        const option3 = document.createElement('option');
        option3.value = className;
        option3.textContent = className;
        newCareClassSelect.appendChild(option3);
        
        const option4 = document.createElement('option');
        option4.value = className;
        option4.textContent = className;
        stopCareClassSelect.appendChild(option4);
    });
}

function generateTrialStudentFields() {
    const count = parseInt(document.getElementById('trialStudentsTotal').value) || 0;
    const container = document.getElementById('trialStudentsContainer');
    
    if (count === 0) {
        container.innerHTML = '';
        trialStudentsArray = [];
        return;
    }
    
    // Preserve existing data if count increased
    const currentCount = trialStudentsArray.length;
    if (count > currentCount) {
        for (let i = currentCount; i < count; i++) {
            trialStudentsArray.push({
                name: '',
                gender: '',
                class: '',
                program: ''
            });
        }
    } else if (count < currentCount) {
        trialStudentsArray = trialStudentsArray.slice(0, count);
    }
    
    let html = '<h4 style="color: #667eea; margin-bottom: 15px;">á”á‰áŸ’á‡á¸áŸá·áŸáŸ’áŸáŸá¶á€á›áŸ’á”á„</h4>';
    
    for (let i = 0; i < count; i++) {
        const student = trialStudentsArray[i];
        html += `
            <div class="student-entry" style="display: block; padding: 20px; margin-bottom: 15px;">
                <h5 style="color: #333; margin-bottom: 15px;">áŸá·áŸáŸ’áŸá‘á¸ ${i + 1}</h5>
                <div class="form-grid">
                    <div class="form-group">
                        <label>áˆáŸ’á˜áŸ„áŸ‡áŸá·áŸáŸ’áŸ *</label>
                        <input type="text" class="trial-name" data-index="${i}" value="${student.name}" placeholder="á”á‰áŸ’á…á¼á›áˆáŸ’á˜áŸ„áŸ‡" onchange="updateTrialStudent(${i}, 'name', this.value)">
                    </div>
                    <div class="form-group">
                        <label>á—áŸá‘ *</label>
                        <select class="trial-gender" data-index="${i}" onchange="updateTrialStudent(${i}, 'gender', this.value)">
                            <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸ --</option>
                            <option value="M" ${student.gender === 'M' ? 'selected' : ''}>á”áŸ’ášá»áŸ</option>
                            <option value="F" ${student.gender === 'F' ? 'selected' : ''}>áŸáŸ’ášá¸</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ááŸ’á“á¶á€áŸ‹ *</label>
                        <select class="trial-class" data-index="${i}" onchange="updateTrialStudent(${i}, 'class', this.value)">
                            <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸááŸ’á“á¶á€áŸ‹ --</option>
                            ${Object.keys(studentData).map(className => 
                                `<option value="${className}" ${student.class === className ? 'selected' : ''}>${className}</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>á€á˜áŸ’á˜áœá·á’á¸áŸá·á€áŸ’áŸá¶ *</label>
                        <select class="trial-program" data-index="${i}" onchange="updateTrialStudent(${i}, 'program', this.value)">
                            <option value="">-- á‡áŸ’ášá¾áŸášá¾áŸ --</option>
                            <option value="full" ${student.program === 'full' ? 'selected' : ''}>á–áŸá‰á€á˜áŸ’á˜áœá·á’á¸áŸá·á€áŸ’áŸá¶</option>
                            <option value="khmer" ${student.program === 'khmer' ? 'selected' : ''}>ááŸ‚á€á˜áŸ’á˜áœá·á’á¸áŸá·á€áŸ’áŸá¶ááŸ’á˜áŸ‚áš</option>
                            <option value="english" ${student.program === 'english' ? 'selected' : ''}>ááŸ‚á€á˜áŸ’á˜áœá·á’á¸áŸá·á€áŸ’áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸ</option>
                        </select>
                    </div>
                </div>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

function updateTrialStudent(index, field, value) {
    if (trialStudentsArray[index]) {
        trialStudentsArray[index][field] = value;
        
        // Auto-update female count when gender is selected
        if (field === 'gender') {
            const femaleCount = trialStudentsArray.filter(s => s.gender === 'F').length;
            document.getElementById('trialFemale').value = femaleCount;
        }
    }
}

function updateLeftStudentList() {
    const className = document.getElementById('leftStudentClass').value;
    const studentSelect = document.getElementById('leftStudentSelect');
    
    studentSelect.innerHTML = '<option value="">-- á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ --</option>';
    
    if (className && studentData[className]) {
        studentData[className].forEach(student => {
            const option = document.createElement('option');
            option.value = JSON.stringify({
                name: student.name,
                class: className,
                id: student.id,
                sex: student.sex
            });
            option.textContent = `${student.id}. ${student.name} (${student.sex === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'})`;
            studentSelect.appendChild(option);
        });
    }
}

function calculateTotalsFromStudentData() {
    let totalCount = 0;
    let totalFemaleCount = 0;
    let morningTotal = 0;
    let morningFemale = 0;
    let afternoonTotal = 0;
    let afternoonFemale = 0;
    
    Object.keys(studentData).forEach(className => {
        const students = studentData[className];
        const classTotal = students.length;
        const classFemale = students.filter(s => s.sex === 'F').length;
        
        // Add to grand total
        totalCount += classTotal;
        totalFemaleCount += classFemale;
        
        // Check if morning or afternoon class
        if (className.includes('á–áŸ’ášá¹á€') || className.toLowerCase().includes('mooning')) {
            morningTotal += classTotal;
            morningFemale += classFemale;
        }
        if (className.includes('ášáŸáŸ€á›') || className.toLowerCase().includes('evening')) {
            afternoonTotal += classTotal;
            afternoonFemale += classFemale;
        }
    });
    
    document.getElementById('totalStudents').value = totalCount;
    document.getElementById('totalFemaleStudents').value = totalFemaleCount;
    document.getElementById('morningTotal').value = morningTotal;
    document.getElementById('morningFemale').value = morningFemale;
    document.getElementById('afternoonTotal').value = afternoonTotal;
    document.getElementById('afternoonFemale').value = afternoonFemale;
}

function addNewStudent() {
    const className = document.getElementById('newStudentClass').value;
    const name = document.getElementById('newStudentName').value.trim();
    const gender = document.getElementById('newStudentGender').value;
    const date = document.getElementById('newStudentDate').value;
    const paymentDuration = document.getElementById('newStudentPaymentDuration').value;
    const customDuration = document.getElementById('customPaymentDuration').value.trim();
    
    if (!className || !name || !gender || !date) {
        alert('áŸá¼á˜á”áŸ†á–áŸá‰á–áŸááŸŒá˜á¶á“á²áŸ’á™á”á¶á“á‚áŸ’ášá”áŸ‹á‚áŸ’ášá¶á“áŸ‹!');
        return;
    }
    
    // Determine final payment duration text
    let finalPaymentDuration = '';
    if (paymentDuration === 'custom' && customDuration) {
        finalPaymentDuration = customDuration;
    } else if (paymentDuration && paymentDuration !== 'custom') {
        const durationMap = {
            '1month': 'áŸ¡ááŸ‚',
            '3months': 'áŸ£ááŸ‚',
            '6months': 'áŸ¦ááŸ‚',
            '1year': 'áŸ¡á†áŸ’á“á¶áŸ†'
        };
        finalPaymentDuration = durationMap[paymentDuration] || '';
    }
    
    // Add to temporary array for this report
    newStudentsArray.push({
        name: name,
        class: className,
        gender: gender,
        date: date,
        paymentDuration: finalPaymentDuration
    });
    
    // Add to attendance system
    if (!studentData[className]) {
        studentData[className] = [];
    }
    
    const newStudentForAttendance = {
        id: Date.now().toString().slice(-3),
        name: name,
        sex: gender
    };
    
    studentData[className].push(newStudentForAttendance);
    saveStudentData();
    
    // Update totals
    const currentTotal = parseInt(document.getElementById('totalStudents').value) || 0;
    const currentFemaleTotal = parseInt(document.getElementById('totalFemaleStudents').value) || 0;
    
    document.getElementById('totalStudents').value = currentTotal + 1;
    if (gender === 'F') {
        document.getElementById('totalFemaleStudents').value = currentFemaleTotal + 1;
    }
    
    // Update morning/afternoon totals based on class
    if (className.includes('á–áŸ’ášá¹á€') || className.toLowerCase().includes('mooning')) {
        const morningTotal = parseInt(document.getElementById('morningTotal').value) || 0;
        document.getElementById('morningTotal').value = morningTotal + 1;
        if (gender === 'F') {
            const morningFemale = parseInt(document.getElementById('morningFemale').value) || 0;
            document.getElementById('morningFemale').value = morningFemale + 1;
        }
    }
    if (className.includes('ášáŸáŸ€á›') || className.toLowerCase().includes('evening')) {
        const afternoonTotal = parseInt(document.getElementById('afternoonTotal').value) || 0;
        document.getElementById('afternoonTotal').value = afternoonTotal + 1;
        if (gender === 'F') {
            const afternoonFemale = parseInt(document.getElementById('afternoonFemale').value) || 0;
            document.getElementById('afternoonFemale').value = afternoonFemale + 1;
        }
    }
    
    // Clear inputs
    document.getElementById('newStudentName').value = '';
    document.getElementById('newStudentGender').value = '';
    document.getElementById('newStudentDate').value = '';
    document.getElementById('newStudentPaymentDuration').value = '';
    document.getElementById('customPaymentDuration').value = '';
    document.getElementById('customPaymentField').style.display = 'none';
    
    // Update display
    displayNewStudents();
    populateClassDropdowns();
    
    // Refresh attendance list if viewing that class
    const activeClassElement = document.querySelector('.class-item.active');
    if (activeClassElement && activeClassElement.innerText === className) {
        renderStudents(className);
    }
}

function displayNewStudents() {
    const container = document.getElementById('newStudentsList');
    if (newStudentsArray.length === 0) {
        container.innerHTML = '';
        return;
    }
    
    container.innerHTML = newStudentsArray.map((student, index) => `
        <div class="student-entry">
            <div class="student-entry-info">
                <div class="student-entry-name">${student.name}</div>
                <div class="student-entry-details">ááŸ’á“á¶á€áŸ‹: ${student.class} | á—áŸá‘: ${student.gender === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'} | ááŸ’á„áŸƒá…á¼á›: ${student.date}${student.paymentDuration ? ' | á”á„áŸ‹: ' + student.paymentDuration : ''}</div>
            </div>
            <button class="btn-remove" onclick="removeNewStudent(${index})">á›á»á”</button>
        </div>
    `).join('');
}

function removeNewStudent(index) {
    const student = newStudentsArray[index];
    
    // Subtract from totals
    const currentTotal = parseInt(document.getElementById('totalStudents').value) || 0;
    document.getElementById('totalStudents').value = Math.max(0, currentTotal - 1);
    
    if (student.gender === 'F') {
        const currentFemaleTotal = parseInt(document.getElementById('totalFemaleStudents').value) || 0;
        document.getElementById('totalFemaleStudents').value = Math.max(0, currentFemaleTotal - 1);
    }
    
    // Update morning/afternoon totals
    if (student.class.includes('á–áŸ’ášá¹á€') || student.class.toLowerCase().includes('mooning')) {
        const morningTotal = parseInt(document.getElementById('morningTotal').value) || 0;
        document.getElementById('morningTotal').value = Math.max(0, morningTotal - 1);
        if (student.gender === 'F') {
            const morningFemale = parseInt(document.getElementById('morningFemale').value) || 0;
            document.getElementById('morningFemale').value = Math.max(0, morningFemale - 1);
        }
    }
    if (student.class.includes('ášáŸáŸ€á›') || student.class.toLowerCase().includes('evening')) {
        const afternoonTotal = parseInt(document.getElementById('afternoonTotal').value) || 0;
        document.getElementById('afternoonTotal').value = Math.max(0, afternoonTotal - 1);
        if (student.gender === 'F') {
            const afternoonFemale = parseInt(document.getElementById('afternoonFemale').value) || 0;
            document.getElementById('afternoonFemale').value = Math.max(0, afternoonFemale - 1);
        }
    }
    
    newStudentsArray.splice(index, 1);
    displayNewStudents();
}

function addLeftStudent() {
    const studentJson = document.getElementById('leftStudentSelect').value;
    const date = document.getElementById('leftStudentDate').value;
    const reason = document.getElementById('leftReason').value.trim();
    
    if (!studentJson || !date) {
        alert('áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ á“á·á„á€á¶á›á”ášá·á…áŸ’á†áŸá‘!');
        return;
    }
    
    const studentInfo = JSON.parse(studentJson);
    
    leftStudentsArray.push({
        name: studentInfo.name,
        class: studentInfo.class,
        id: studentInfo.id,
        sex: studentInfo.sex,
        date: date,
        reason: reason || "á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹"
    });
    
    // Subtract from totals
    const currentTotal = parseInt(document.getElementById('totalStudents').value) || 0;
    document.getElementById('totalStudents').value = Math.max(0, currentTotal - 1);
    
    if (studentInfo.sex === 'F') {
        const currentFemaleTotal = parseInt(document.getElementById('totalFemaleStudents').value) || 0;
        document.getElementById('totalFemaleStudents').value = Math.max(0, currentFemaleTotal - 1);
    }
    
    // Update morning/afternoon totals
    if (studentInfo.class.includes('á–áŸ’ášá¹á€') || studentInfo.class.toLowerCase().includes('mooning')) {
        const morningTotal = parseInt(document.getElementById('morningTotal').value) || 0;
        document.getElementById('morningTotal').value = Math.max(0, morningTotal - 1);
        if (studentInfo.sex === 'F') {
            const morningFemale = parseInt(document.getElementById('morningFemale').value) || 0;
            document.getElementById('morningFemale').value = Math.max(0, morningFemale - 1);
        }
    }
    if (studentInfo.class.includes('ášáŸáŸ€á›') || studentInfo.class.toLowerCase().includes('evening')) {
        const afternoonTotal = parseInt(document.getElementById('afternoonTotal').value) || 0;
        document.getElementById('afternoonTotal').value = Math.max(0, afternoonTotal - 1);
        if (studentInfo.sex === 'F') {
            const afternoonFemale = parseInt(document.getElementById('afternoonFemale').value) || 0;
            document.getElementById('afternoonFemale').value = Math.max(0, afternoonFemale - 1);
        }
    }
    
    // Clear inputs
    document.getElementById('leftStudentClass').value = '';
    document.getElementById('leftStudentSelect').value = '';
    document.getElementById('leftStudentDate').value = '';
    document.getElementById('leftReason').value = '';
    
    displayLeftStudents();
    updateLeftStudentList();
}

function displayLeftStudents() {
    const container = document.getElementById('leftStudentsList');
    if (leftStudentsArray.length === 0) {
        container.innerHTML = '';
        return;
    }
    
    container.innerHTML = leftStudentsArray.map((student, index) => `
        <div class="student-entry">
            <div class="student-entry-info">
                <div class="student-entry-name">${student.name}</div>
                <div class="student-entry-details">ááŸ’á“á¶á€áŸ‹: ${student.class} | ááŸ’á„áŸƒáˆá”áŸ‹: ${student.date} | á˜á¼á›á áŸáá»: ${student.reason}</div>
            </div>
            <button class="btn-remove" onclick="removeLeftStudent(${index})">á›á»á”</button>
        </div>
    `).join('');
}

function removeLeftStudent(index) {
    const student = leftStudentsArray[index];
    
    // Add back to totals
    const currentTotal = parseInt(document.getElementById('totalStudents').value) || 0;
    document.getElementById('totalStudents').value = currentTotal + 1;
    
    if (student.sex === 'F') {
        const currentFemaleTotal = parseInt(document.getElementById('totalFemaleStudents').value) || 0;
        document.getElementById('totalFemaleStudents').value = currentFemaleTotal + 1;
    }
    
    // Update morning/afternoon totals
    if (student.class.includes('á–áŸ’ášá¹á€') || student.class.toLowerCase().includes('mooning')) {
        const morningTotal = parseInt(document.getElementById('morningTotal').value) || 0;
        document.getElementById('morningTotal').value = morningTotal + 1;
        if (student.sex === 'F') {
            const morningFemale = parseInt(document.getElementById('morningFemale').value) || 0;
            document.getElementById('morningFemale').value = morningFemale + 1;
        }
    }
    if (student.class.includes('ášáŸáŸ€á›') || student.class.toLowerCase().includes('evening')) {
        const afternoonTotal = parseInt(document.getElementById('afternoonTotal').value) || 0;
        document.getElementById('afternoonTotal').value = afternoonTotal + 1;
        if (student.sex === 'F') {
            const afternoonFemale = parseInt(document.getElementById('afternoonFemale').value) || 0;
            document.getElementById('afternoonFemale').value = afternoonFemale + 1;
        }
    }
    
    leftStudentsArray.splice(index, 1);
    displayLeftStudents();
}

// ========== CARE SERVICE FUNCTIONS ==========
function updateNewCareStudentList() {
    const className = document.getElementById('newCareStudentClass').value;
    const studentSelect = document.getElementById('newCareStudentSelect');
    
    studentSelect.innerHTML = '<option value="">-- á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ --</option>';
    
    if (className && studentData[className]) {
        studentData[className].forEach(student => {
            const option = document.createElement('option');
            option.value = JSON.stringify({
                name: student.name,
                class: className,
                id: student.id,
                sex: student.sex
            });
            option.textContent = `${student.id}. ${student.name} (${student.sex === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'})`;
            studentSelect.appendChild(option);
        });
    }
}

function updateStopCareStudentList() {
    const className = document.getElementById('stopCareStudentClass').value;
    const studentSelect = document.getElementById('stopCareStudentSelect');
    
    studentSelect.innerHTML = '<option value="">-- á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ --</option>';
    
    if (className && studentData[className]) {
        studentData[className].forEach(student => {
            const option = document.createElement('option');
            option.value = JSON.stringify({
                name: student.name,
                class: className,
                id: student.id,
                sex: student.sex
            });
            option.textContent = `${student.id}. ${student.name} (${student.sex === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'})`;
            studentSelect.appendChild(option);
        });
    }
}

function addNewCareStudent() {
    const studentJson = document.getElementById('newCareStudentSelect').value;
    const date = document.getElementById('newCareStartDate').value;
    
    if (!studentJson || !date) {
        alert('áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ á“á·á„á€á¶á›á”ášá·á…áŸ’á†áŸá‘!');
        return;
    }
    
    const studentInfo = JSON.parse(studentJson);
    
    newCareStudentsArray.push({
        name: studentInfo.name,
        class: studentInfo.class,
        id: studentInfo.id,
        sex: studentInfo.sex,
        date: date
    });
    
    // Update totals - force update by reading current value first
    const currentTotal = parseInt(document.getElementById('careServiceTotal').value) || 0;
    const currentFemale = parseInt(document.getElementById('careServiceFemale').value) || 0;
    
    document.getElementById('careServiceTotal').value = currentTotal + 1;
    
    if (studentInfo.sex === 'F') {
        document.getElementById('careServiceFemale').value = currentFemale + 1;
    }
    
    console.log('âœ… á”á“áŸ’ááŸ‚á˜áŸá·áŸáŸ’áŸá˜á¾á›ááŸ‚áš:', studentInfo.name, '| áŸášá»á”á¥á¡á¼áœ:', currentTotal + 1);
    
    // Clear inputs
    document.getElementById('newCareStudentClass').value = '';
    document.getElementById('newCareStudentSelect').value = '';
    document.getElementById('newCareStartDate').value = '';
    
    displayNewCareStudents();
    updateNewCareStudentList();
}

function displayNewCareStudents() {
    const container = document.getElementById('newCareStudentsList');
    if (newCareStudentsArray.length === 0) {
        container.innerHTML = '';
        return;
    }
    
    container.innerHTML = newCareStudentsArray.map((student, index) => `
        <div class="student-entry">
            <div class="student-entry-info">
                <div class="student-entry-name">${student.name}</div>
                <div class="student-entry-details">ááŸ’á“á¶á€áŸ‹: ${student.class} | á€á¶á›á”ášá·á…áŸ’á†áŸá‘á…á¶á”áŸ‹á•áŸ’áá¾á˜: ${student.date}</div>
            </div>
            <button class="btn-remove" onclick="removeNewCareStudent(${index})">á›á»á”</button>
        </div>
    `).join('');
}

function removeNewCareStudent(index) {
    const student = newCareStudentsArray[index];
    
    // Subtract from totals
    const currentTotal = parseInt(document.getElementById('careServiceTotal').value) || 0;
    document.getElementById('careServiceTotal').value = Math.max(0, currentTotal - 1);
    
    if (student.sex === 'F') {
        const currentFemaleTotal = parseInt(document.getElementById('careServiceFemale').value) || 0;
        document.getElementById('careServiceFemale').value = Math.max(0, currentFemaleTotal - 1);
    }
    
    newCareStudentsArray.splice(index, 1);
    displayNewCareStudents();
}

function addStopCareStudent() {
    const studentJson = document.getElementById('stopCareStudentSelect').value;
    const date = document.getElementById('stopCareDate').value;
    const reason = document.getElementById('stopCareReason').value.trim();
    
    if (!studentJson || !date) {
        alert('áŸá¼á˜á‡áŸ’ášá¾áŸášá¾áŸáŸá·áŸáŸ’áŸ á“á·á„á€á¶á›á”ášá·á…áŸ’á†áŸá‘!');
        return;
    }
    
    const studentInfo = JSON.parse(studentJson);
    
    stopCareStudentsArray.push({
        name: studentInfo.name,
        class: studentInfo.class,
        id: studentInfo.id,
        sex: studentInfo.sex,
        date: date,
        reason: reason || "á˜á·á“á”á¶á“á”á‰áŸ’á‡á¶á€áŸ‹"
    });
    
    // Subtract from totals
    const currentTotal = parseInt(document.getElementById('careServiceTotal').value) || 0;
    document.getElementById('careServiceTotal').value = Math.max(0, currentTotal - 1);
    
    if (studentInfo.sex === 'F') {
        const currentFemaleTotal = parseInt(document.getElementById('careServiceFemale').value) || 0;
        document.getElementById('careServiceFemale').value = Math.max(0, currentFemaleTotal - 1);
    }
    
    // Clear inputs
    document.getElementById('stopCareStudentClass').value = '';
    document.getElementById('stopCareStudentSelect').value = '';
    document.getElementById('stopCareDate').value = '';
    document.getElementById('stopCareReason').value = '';
    
    displayStopCareStudents();
    updateStopCareStudentList();
}

function displayStopCareStudents() {
    const container = document.getElementById('stopCareStudentsList');
    if (stopCareStudentsArray.length === 0) {
        container.innerHTML = '';
        return;
    }
    
    container.innerHTML = stopCareStudentsArray.map((student, index) => `
        <div class="student-entry">
            <div class="student-entry-info">
                <div class="student-entry-name">${student.name}</div>
                <div class="student-entry-details">ááŸ’á“á¶á€áŸ‹: ${student.class} | á€á¶á›á”ášá·á…áŸ’á†áŸá‘áˆá”áŸ‹: ${student.date} | á˜á¼á›á áŸáá»: ${student.reason}</div>
            </div>
            <button class="btn-remove" onclick="removeStopCareStudent(${index})">á›á»á”</button>
        </div>
    `).join('');
}

function removeStopCareStudent(index) {
    const student = stopCareStudentsArray[index];
    
    // Add back to totals
    const currentTotal = parseInt(document.getElementById('careServiceTotal').value) || 0;
    document.getElementById('careServiceTotal').value = currentTotal + 1;
    
    if (student.sex === 'F') {
        const currentFemaleTotal = parseInt(document.getElementById('careServiceFemale').value) || 0;
        document.getElementById('careServiceFemale').value = currentFemaleTotal + 1;
    }
    
    stopCareStudentsArray.splice(index, 1);
    displayStopCareStudents();
}

document.getElementById('reportForm').addEventListener('submit', function(e) {
    e.preventDefault();

    // Validate trial students if any
    const trialCount = parseInt(document.getElementById('trialStudentsTotal').value) || 0;
    if (trialCount > 0) {
        const incompleteTrialStudents = trialStudentsArray.filter(s => 
            !s.name || !s.gender || !s.class || !s.program
        );
        if (incompleteTrialStudents.length > 0) {
            alert(`áŸá¼á˜á”áŸ†á–áŸá‰á–áŸááŸŒá˜á¶á“áŸá·áŸáŸ’áŸáŸá¶á€á›áŸ’á”á„á²áŸ’á™á”á¶á“á‚áŸ’ášá”áŸ‹á‚áŸ’ášá¶á“áŸ‹! á“áŸ…áŸá›áŸ‹ ${incompleteTrialStudents.length} á“á¶á€áŸ‹`);
            return;
        }
    }

    const report = {
        id: Date.now(),
        reportDate: document.getElementById('reportDate').value,
        totalStudents: parseInt(document.getElementById('totalStudents').value),
        totalFemaleStudents: parseInt(document.getElementById('totalFemaleStudents').value),
        fullTimeStudents: parseInt(document.getElementById('fullTimeStudents').value) || 0,
        fullTimeFemale: parseInt(document.getElementById('fullTimeFemale').value) || 0,
        khmerOnlyTotal: parseInt(document.getElementById('khmerOnlyTotal').value) || 0,
        khmerOnlyFemale: parseInt(document.getElementById('khmerOnlyFemale').value) || 0,
        englishOnlyTotal: parseInt(document.getElementById('englishOnlyTotal').value) || 0,
        englishOnlyFemale: parseInt(document.getElementById('englishOnlyFemale').value) || 0,
        trialStudentsTotal: parseInt(document.getElementById('trialStudentsTotal').value) || 0,
        trialFemale: parseInt(document.getElementById('trialFemale').value) || 0,
        trialDate: document.getElementById('trialDate').value,
        trialDuration: document.getElementById('trialDuration').value,
        trialStudents: [...trialStudentsArray],
        careServiceTotal: parseInt(document.getElementById('careServiceTotal').value) || 0,
        careServiceFemale: parseInt(document.getElementById('careServiceFemale').value) || 0,
        newCareStudents: [...newCareStudentsArray],
        stopCareStudents: [...stopCareStudentsArray],
        morningTotal: parseInt(document.getElementById('morningTotal').value) || 0,
        morningFemale: parseInt(document.getElementById('morningFemale').value) || 0,
        morningAbsentTotal: parseInt(document.getElementById('morningAbsentTotal').value) || 0,
        morningAbsentFemale: parseInt(document.getElementById('morningAbsentFemale').value) || 0,
        morningParentPermission: parseInt(document.getElementById('morningParentPermission').value) || 0,
        morningParentPermissionFemale: parseInt(document.getElementById('morningParentPermissionFemale').value) || 0,
        morningSchoolContact: parseInt(document.getElementById('morningSchoolContact').value) || 0,
        morningSchoolContactFemale: parseInt(document.getElementById('morningSchoolContactFemale').value) || 0,
        afternoonTotal: parseInt(document.getElementById('afternoonTotal').value) || 0,
        afternoonFemale: parseInt(document.getElementById('afternoonFemale').value) || 0,
        afternoonAbsentTotal: parseInt(document.getElementById('afternoonAbsentTotal').value) || 0,
        afternoonAbsentFemale: parseInt(document.getElementById('afternoonAbsentFemale').value) || 0,
        afternoonParentPermission: parseInt(document.getElementById('afternoonParentPermission').value) || 0,
        afternoonParentPermissionFemale: parseInt(document.getElementById('afternoonParentPermissionFemale').value) || 0,
        afternoonSchoolContact: parseInt(document.getElementById('afternoonSchoolContact').value) || 0,
        afternoonSchoolContactFemale: parseInt(document.getElementById('afternoonSchoolContactFemale').value) || 0,
        newStudents: [...newStudentsArray],
        leftStudents: [...leftStudentsArray],
        createdAt: new Date().toISOString()
    };

    reports.push(report);
    saveReports();
    
    // Send to Telegram if there are changes
    if (newStudentsArray.length > 0 || leftStudentsArray.length > 0 || trialStudentsArray.length > 0 || 
        newCareStudentsArray.length > 0 || stopCareStudentsArray.length > 0) {
        sendStudentChangesToTelegram(report);
    }
    
    alert('ášá€áŸ’áŸá¶á‘á»á€ášá”á¶á™á€á¶ášááŸá”á¶á“á‡áŸ„á‚á‡áŸá™!');
    
    // Reset arrays
    newStudentsArray = [];
    leftStudentsArray = [];
    trialStudentsArray = [];
    newCareStudentsArray = [];
    stopCareStudentsArray = [];
    displayNewStudents();
    displayLeftStudents();
    displayNewCareStudents();
    displayStopCareStudents();
    document.getElementById('trialStudentsContainer').innerHTML = '';
    
    // Clear the input fields
    document.getElementById('newStudentClass').value = '';
    document.getElementById('newStudentName').value = '';
    document.getElementById('newStudentGender').value = '';
    document.getElementById('newStudentDate').value = '';
    document.getElementById('leftStudentClass').value = '';
    document.getElementById('leftStudentSelect').value = '';
    document.getElementById('leftStudentDate').value = '';
    document.getElementById('leftReason').value = '';
    document.getElementById('trialStudentsTotal').value = '0';
    document.getElementById('newCareStudentClass').value = '';
    document.getElementById('stopCareStudentClass').value = '';
});

async function sendStudentChangesToTelegram(report) {
    const chatId = '-1003814592979';
    
    let message = `ğŸ“Š *ášá”á¶á™á€á¶ášááŸáŸáŸ’áá·áá·áŸá·áŸáŸ’áŸá”áŸ’ášá…á¶áŸ†ááŸ’á„áŸƒ*\n\n`;
    message += `ğŸ“… *ááŸ’á„áŸƒááŸ‚á†áŸ’á“á¶áŸ†:* ${report.reportDate}\n\n`;
    
    // áŸáŸ’áá·áá·áŸá·áŸáŸ’áŸáŸášá»á”
    message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    message += `ğŸ‘¥ *áŸáŸ’áá·áá·áŸá·áŸáŸ’áŸáŸášá»á”*\n`;
    message += `â€¢ áŸá·áŸáŸ’áŸáŸášá»á”á‘á¶áŸ†á„á–áŸ’ášá¹á€á“á·á„ášáŸáŸ€á›: ${report.totalStudents} á“á¶á€áŸ‹\n`;
    message += `â€¢ áŸá·áŸáŸ’áŸáŸáŸ’ášá¸áŸášá»á”: ${report.totalFemaleStudents} á“á¶á€áŸ‹\n`;
    if (report.fullTimeStudents > 0) {
        message += `â€¢ áŸá·áŸáŸ’áŸášáŸ€á“á–áŸá‰á˜áŸ‰áŸ„á„: ${report.fullTimeStudents} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.fullTimeFemale} á“á¶á€áŸ‹)\n`;
    }
    if (report.khmerOnlyTotal > 0) {
        message += `â€¢ áŸá·áŸáŸ’áŸááŸ‚á€á˜áŸ’á˜áœá·á’á¸á—á¶áŸá¶ááŸ’á˜áŸ‚áš: ${report.khmerOnlyTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.khmerOnlyFemale} á“á¶á€áŸ‹)\n`;
    }
    if (report.englishOnlyTotal > 0) {
        message += `â€¢ áŸá·áŸáŸ’áŸááŸ‚á€á˜áŸ’á˜áœá·á’á¸á—á¶áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸ: ${report.englishOnlyTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.englishOnlyFemale} á“á¶á€áŸ‹)\n`;
    }
    message += `\n`;
    
    // áŸáŸ’áá·áá·áŸá·áŸáŸ’áŸáŸá¶á€á›áŸ’á”á„
    if (report.trialStudents && report.trialStudents.length > 0) {
        message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        message += `ğŸ“ *áŸá·áŸáŸ’áŸáŸá¶á€á›áŸ’á”á„ (${report.trialStudents.length} á“á¶á€áŸ‹)*\n`;
        if (report.trialDate) message += `â€¢ á€á¶á›á”ášá·á…áŸ’á†áŸá‘: ${report.trialDate}\n`;
        if (report.trialDuration) message += `â€¢ ášá™áŸˆá–áŸá›: ${report.trialDuration}\n`;
        message += `\n`;
        report.trialStudents.forEach((student, index) => {
            const programText = student.program === 'full' ? 'á–áŸá‰á€á˜áŸ’á˜áœá·á’á¸áŸá·á€áŸ’áŸá¶' : 
                               student.program === 'khmer' ? 'ááŸ‚á€á˜áŸ’á˜áœá·á’á¸áŸá·á€áŸ’áŸá¶ááŸ’á˜áŸ‚áš' : 
                               student.program === 'english' ? 'ááŸ‚á€á˜áŸ’á˜áœá·á’á¸áŸá·á€áŸ’áŸá¶á¢á„áŸ‹á‚áŸ’á›áŸáŸ' : '';
            message += `${index + 1}. ${student.name}\n`;
            message += `   â€¢ ááŸ’á“á¶á€áŸ‹: ${student.class}\n`;
            message += `   â€¢ á—áŸá‘: ${student.gender === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'}\n`;
            message += `   â€¢ á€á˜áŸ’á˜áœá·á’á¸: ${programText}\n\n`;
        });
    }
    
    // áŸá·áŸáŸ’áŸá‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚áš
    if (report.careServiceTotal > 0 || (report.newCareStudents && report.newCareStudents.length > 0) || 
        (report.stopCareStudents && report.stopCareStudents.length > 0)) {
        message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        message += `ğŸ½ï¸ *áŸá·áŸáŸ’áŸá‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚áš*\n`;
        message += `â€¢ áŸá·áŸáŸ’áŸáŸášá»á”: ${report.careServiceTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.careServiceFemale} á“á¶á€áŸ‹)\n\n`;
        
        if (report.newCareStudents && report.newCareStudents.length > 0) {
            message += `âœ… *á‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚ášááŸ’á˜á¸ (${report.newCareStudents.length} á“á¶á€áŸ‹)*\n`;
            report.newCareStudents.forEach((student, index) => {
                message += `${index + 1}. ${student.name} (${student.class})\n`;
                message += `   â€¢ á…á¶á”áŸ‹á•áŸ’áá¾á˜: ${student.date}\n`;
            });
            message += `\n`;
        }
        
        if (report.stopCareStudents && report.stopCareStudents.length > 0) {
            message += `âŒ *áˆá”áŸ‹á‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚áš (${report.stopCareStudents.length} á“á¶á€áŸ‹)*\n`;
            report.stopCareStudents.forEach((student, index) => {
                message += `${index + 1}. ${student.name} (${student.class})\n`;
                message += `   â€¢ á€á¶á›á”ášá·á…áŸ’á†áŸá‘áˆá”áŸ‹: ${student.date}\n`;
                message += `   â€¢ á˜á¼á›á áŸáá»: ${student.reason}\n`;
            });
            message += `\n`;
        }
    }
    
    // á–áŸá›á–áŸ’ášá¹á€
    if (report.morningTotal > 0) {
        message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        message += `ğŸŒ… *á–áŸá›á–áŸ’ášá¹á€*\n`;
        message += `â€¢ áŸá·áŸáŸ’áŸáŸášá»á”: ${report.morningTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.morningFemale} á“á¶á€áŸ‹)\n`;
        if (report.morningAbsentTotal > 0) {
            message += `â€¢ á¢áœááŸ’áá˜á¶á“áŸášá»á”: ${report.morningAbsentTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.morningAbsentFemale} á“á¶á€áŸ‹)\n`;
        }
        if (report.morningParentPermission > 0) {
            message += `â€¢ á¢á¶áá¶á–áŸ’á™á¶á”á¶á›á“á¶á€áŸ‹áŸá»áŸ†: ${report.morningParentPermission} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.morningParentPermissionFemale} á“á¶á€áŸ‹)\n`;
        }
        if (report.morningSchoolContact > 0) {
            message += `â€¢ áŸá¶á›á¶á‘á¶á€áŸ‹á‘á„á‘áŸ…áŸá½áš: ${report.morningSchoolContact} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.morningSchoolContactFemale} á“á¶á€áŸ‹)\n`;
        }
        message += `\n`;
    }
    
    // á–áŸá›ášáŸáŸ€á›
    if (report.afternoonTotal > 0) {
        message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        message += `ğŸŒ† *á–áŸá›ášáŸáŸ€á›*\n`;
        message += `â€¢ áŸá·áŸáŸ’áŸáŸášá»á”: ${report.afternoonTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.afternoonFemale} á“á¶á€áŸ‹)\n`;
        if (report.afternoonAbsentTotal > 0) {
            message += `â€¢ á¢áœááŸ’áá˜á¶á“áŸášá»á”: ${report.afternoonAbsentTotal} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.afternoonAbsentFemale} á“á¶á€áŸ‹)\n`;
        }
        if (report.afternoonParentPermission > 0) {
            message += `â€¢ á¢á¶áá¶á–áŸ’á™á¶á”á¶á›á“á¶á€áŸ‹áŸá»áŸ†: ${report.afternoonParentPermission} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.afternoonParentPermissionFemale} á“á¶á€áŸ‹)\n`;
        }
        if (report.afternoonSchoolContact > 0) {
            message += `â€¢ áŸá¶á›á¶á‘á¶á€áŸ‹á‘á„á‘áŸ…áŸá½áš: ${report.afternoonSchoolContact} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.afternoonSchoolContactFemale} á“á¶á€áŸ‹)\n`;
        }
        message += `\n`;
    }
    
    // áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸
    if (report.newStudents && report.newStudents.length > 0) {
        message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        message += `âœ… *áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸ (${report.newStudents.length} á“á¶á€áŸ‹)*\n\n`;
        report.newStudents.forEach((student, index) => {
            message += `${index + 1}. ${student.name}\n`;
            message += `   â€¢ ááŸ’á“á¶á€áŸ‹: ${student.class}\n`;
            message += `   â€¢ á—áŸá‘: ${student.gender === 'M' ? 'á”áŸ’ášá»áŸ' : 'áŸáŸ’ášá¸'}\n`;
            message += `   â€¢ á€á¶á›á”ášá·á…áŸ’á†áŸá‘á…á¼á›: ${student.date}\n`;
            if (student.paymentDuration) {
                message += `   â€¢ ášá™áŸˆá–áŸá›á”á„áŸ‹ááŸ’á›áŸƒáŸá·á€áŸ’áŸá¶: ${student.paymentDuration}\n`;
            }
            message += `\n`;
        });
    }
    
    // áŸá·áŸáŸ’áŸáˆá”áŸ‹
    if (report.leftStudents && report.leftStudents.length > 0) {
        message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        message += `âŒ *áŸá·áŸáŸ’áŸáˆá”áŸ‹ (${report.leftStudents.length} á“á¶á€áŸ‹)*\n\n`;
        report.leftStudents.forEach((student, index) => {
            message += `${index + 1}. ${student.name}\n`;
            message += `   â€¢ ááŸ’á“á¶á€áŸ‹: ${student.class}\n`;
            message += `   â€¢ á€á¶á›á”ášá·á…áŸ’á†áŸá‘áˆá”áŸ‹: ${student.date}\n`;
            message += `   â€¢ á˜á¼á›á áŸáá»: ${student.reason}\n\n`;
        });
    }
    
    // áŸá„áŸ’ááŸá”
    message += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
    message += `ğŸ“‹ *áŸá„áŸ’ááŸá”*\n`;
    message += `ğŸ“ áŸá·áŸáŸ’áŸáŸá¶á€á›áŸ’á”á„: ${report.trialStudents ? report.trialStudents.length : 0} á“á¶á€áŸ‹\n`;
    message += `ğŸ½ï¸ áŸá·áŸáŸ’áŸá‘á‘á½á›á€á¶ášá˜á¾á›ááŸ‚áš: ${report.careServiceTotal || 0} á“á¶á€áŸ‹\n`;
    message += `ğŸ“¥ áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸: ${report.newStudents ? report.newStudents.length : 0} á“á¶á€áŸ‹\n`;
    message += `ğŸ“¤ áŸá·áŸáŸ’áŸáˆá”áŸ‹: ${report.leftStudents ? report.leftStudents.length : 0} á“á¶á€áŸ‹`;

    try {
        const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                chat_id: chatId,
                text: message,
                parse_mode: 'Markdown'
            })
        });

        const result = await response.json();
        
        if (result.ok) {
            alert('âœ… á•áŸ’á‰á¾á–áŸááŸŒá˜á¶á“á‘áŸ… Telegram ášá½á…ášá¶á›áŸ‹!');
        } else {
            alert('âš ï¸ á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá•áŸ’á‰á¾á‘áŸ… Telegram:\n' + (result.description || 'Unknown error'));
        }
    } catch (error) {
        alert('âŒ á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášáá—áŸ’á‡á¶á”áŸ‹á‘áŸ… Telegram:\n' + error.message);
    }
}

function displayReports() {
    const container = document.getElementById('reportsList');
    
    if (reports.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>á˜á·á“á‘á¶á“áŸ‹á˜á¶á“ášá”á¶á™á€á¶ášááŸ</h3>
                <p>áŸá¼á˜á…á»á…á›á¾ "á”á„áŸ’á€á¾áášá”á¶á™á€á¶ášááŸááŸ’á˜á¸" áŠá¾á˜áŸ’á”á¸á”á‰áŸ’á…á¼á›ášá”á¶á™á€á¶ášááŸ</p>
            </div>
        `;
        return;
    }

    const sortedReports = [...reports].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

    container.innerHTML = sortedReports.map(report => {
        const newStudentsCount = Array.isArray(report.newStudents) ? report.newStudents.length : 0;
        const leftStudentsCount = Array.isArray(report.leftStudents) ? report.leftStudents.length : 0;
        const trialStudentsCount = Array.isArray(report.trialStudents) ? report.trialStudents.length : 0;
        
        return `
            <div class="report-card">
                <div class="report-header">
                    <div class="report-title">ášá”á¶á™á€á¶ášááŸááŸ’á„áŸƒá‘á¸ ${report.reportDate}</div>
                </div>
                
                <div class="report-stats">
                    <div class="stat-item">
                        <div class="stat-label">áŸá·áŸáŸ’áŸáŸášá»á”</div>
                        <div class="stat-value">${report.totalStudents} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">áŸá·áŸáŸ’áŸáŸáŸ’ášá¸</div>
                        <div class="stat-value">${report.totalFemaleStudents || 0} á“á¶á€áŸ‹</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">á–áŸá›á–áŸ’ášá¹á€</div>
                        <div class="stat-value">${report.morningTotal || 0} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.morningFemale || 0})</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">á–áŸá›ášáŸáŸ€á›</div>
                        <div class="stat-value">${report.afternoonTotal || 0} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.afternoonFemale || 0})</div>
                    </div>
                    ${trialStudentsCount > 0 ? `
                    <div class="stat-item">
                        <div class="stat-label">áŸá¶á€á›áŸ’á”á„</div>
                        <div class="stat-value">${trialStudentsCount} á“á¶á€áŸ‹ (áŸáŸ’ášá¸ ${report.trialFemale || 0})</div>
                        ${Array.isArray(report.trialStudents) && report.trialStudents.length > 0 ? 
                            '<div class="stat-label" style="margin-top: 5px; font-size: 12px;">' + 
                            report.trialStudents.map(s => s.name + ' (' + s.class + ')').join(', ') + 
                            '</div>' : ''}
                    </div>
                    ` : ''}
                    <div class="stat-item">
                        <div class="stat-label">á…á¼á›ááŸ’á˜á¸</div>
                        <div class="stat-value">${newStudentsCount} á“á¶á€áŸ‹</div>
                        ${newStudentsCount > 0 && Array.isArray(report.newStudents) ? '<div class="stat-label" style="margin-top: 5px; font-size: 12px;">' + report.newStudents.map(s => s.name + ' (' + s.class + ')').join(', ') + '</div>' : ''}
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">áˆá”áŸ‹</div>
                        <div class="stat-value">${leftStudentsCount} á“á¶á€áŸ‹</div>
                        ${leftStudentsCount > 0 && Array.isArray(report.leftStudents) ? '<div class="stat-label" style="margin-top: 5px; font-size: 12px;">' + report.leftStudents.map(s => s.name + ' (' + s.class + ')').join(', ') + '</div>' : ''}
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-main btn-small btn-danger" onclick="deleteReport('${report.id}')">á›á»á”</button>
                </div>
            </div>
        `;
    }).join('');
}

function displaySummary() {
    const container = document.getElementById('summaryContent');
    
    if (reports.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <h3>á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á‘á·á“áŸ’á“á“áŸá™áŸá„áŸ’ááŸá”</h3>
                <p>áŸá¼á˜á”á‰áŸ’á…á¼á›ášá”á¶á™á€á¶ášááŸá˜á»á“áŸá·á“</p>
            </div>
        `;
        return;
    }

    const totalReports = reports.length;
    const avgTotal = Math.round(reports.reduce((sum, r) => sum + r.totalStudents, 0) / totalReports);
    const avgFemale = Math.round(reports.reduce((sum, r) => sum + (r.totalFemaleStudents || 0), 0) / totalReports);
    const totalNew = reports.reduce((sum, r) => sum + (Array.isArray(r.newStudents) ? r.newStudents.length : 0), 0);
    const totalLeft = reports.reduce((sum, r) => sum + (Array.isArray(r.leftStudents) ? r.leftStudents.length : 0), 0);

    container.innerHTML = `
        <div class="summary-grid-stats">
            <div class="summary-card">
                <h4>á…áŸ†á“á½á“ášá”á¶á™á€á¶ášááŸ</h4>
                <div class="number">${totalReports}</div>
            </div>
            <div class="summary-card">
                <h4>á˜á’áŸ’á™á˜áŸá·áŸáŸ’áŸáŸášá»á”</h4>
                <div class="number">${avgTotal}</div>
            </div>
            <div class="summary-card">
                <h4>á˜á’áŸ’á™á˜áŸá·áŸáŸ’áŸáŸáŸ’ášá¸</h4>
                <div class="number">${avgFemale}</div>
            </div>
            <div class="summary-card">
                <h4>áŸášá»á”áŸá·áŸáŸ’áŸá…á¼á›ááŸ’á˜á¸</h4>
                <div class="number">${totalNew}</div>
            </div>
            <div class="summary-card">
                <h4>áŸášá»á”áŸá·áŸáŸ’áŸáˆá”áŸ‹</h4>
                <div class="number">${totalLeft}</div>
            </div>
        </div>
    `;
}

function deleteReport(reportId) {
    if (confirm('áá¾á¢áŸ’á“á€á”áŸ’ášá¶á€áŠáá¶á…á„áŸ‹á›á»á”ášá”á¶á™á€á¶ášááŸá“áŸáŸ‡á˜áŸ‚á“á‘áŸ?')) {
        reports = reports.filter(r => r.id != reportId);
        saveReports();
        displayReports();
    }
}

function resetReportForm() {
    document.getElementById('reportForm').reset();
    newStudentsArray = [];
    leftStudentsArray = [];
    trialStudentsArray = [];
    newCareStudentsArray = [];
    stopCareStudentsArray = [];
    displayNewStudents();
    displayLeftStudents();
    displayNewCareStudents();
    displayStopCareStudents();
    document.getElementById('trialStudentsContainer').innerHTML = '';
    calculateTotalsFromStudentData();
}

// Initialize
window.onload = () => {
    loadStudentData();
    loadReports();
    
    const firstClass = Object.keys(studentData)[0];
    if(firstClass) {
        selectedClassName = firstClass;
        renderStudents(firstClass);
    }
    
    populateClassDropdowns();
    
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('reportDate').value = today;
    
    calculateTotalsFromStudentData();
};
</script>

</body>
</html>
